navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(t=>{console.log("*** Service Worker registered ***")}).catch(function(t){console.log(t)}),function(){function t(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function e(e,n,r){var o,a=new Promise(function(a,s){t(o=e[n].apply(e,r)).then(a,s)});return a.request=o,a}function n(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function r(t,n,r,o){o.forEach(function(o){o in r.prototype&&(t.prototype[o]=function(){return e(this[n],o,arguments)})})}function o(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function a(t,n,r,o){o.forEach(function(o){o in r.prototype&&(t.prototype[o]=function(){return t=this[n],(r=e(t,o,arguments)).then(function(t){if(t)return new i(t,r.request)});var t,r})})}function s(t){this._index=t}function i(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function c(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new c(n)}function p(t){this._db=t}n(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(i,"_cursor",["direction","key","primaryKey","value"]),r(i,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(i.prototype[e]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,r),t(n._request).then(function(t){if(t)return new i(t,n._request)})})})}),u.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},n(u,"_store",["name","keyPath","indexNames","autoIncrement"]),r(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},n(c,"_tx",["objectStoreNames","mode"]),o(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),o(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[u,s].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,n=(e=arguments,Array.prototype.slice.call(e)),r=n[n.length-1],o=this._store||this._index,a=o[t].apply(o,n.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[s,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(o){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():o(r)):o(r)})})})});var h={open:function(t,n,r){var o=e(indexedDB,"open",[t,n]),a=o.request;return a&&(a.onupgradeneeded=function(t){r&&r(new l(a.result,t.oldVersion,a.transaction))}),o.then(function(t){return new p(t)})},delete:function(t){return e(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof module?(module.exports=h,module.exports.default=module.exports):self.idb=h}();var API_URL="http://localhost:1337/restaurants",fetchStatus=0;class IDbOperationsHelper{static checkForIDbSupport(){return"indexedDB"in window?1:0}static openIDb(t,e,n){return idb.open(t,e,t=>{t.createObjectStore(n,{autoIncrement:!0})})}static addToDb(t,e,n,r){t.then(t=>{var o=t.transaction(e,n);return o.objectStore(e).put(r),o.complete}).then(t=>{console.log("Restaurant saved to IDB")})}static getAllData(t,e,n){t.then(t=>t.transaction(e).objectStore(n).getAll()).then(t=>{IDbOperationsHelper.setRestaurantsData(t)})}static getRestaurantsFromServer(t,e,n,r){fetch(API_URL).then(t=>t.json()).then(o=>{o.forEach(t=>{t=IDbOperationsHelper.addMissingData(t)}),1!=fetchStatus&&(fetchStatus=1,o.forEach(r=>{IDbOperationsHelper.addToDb(t,e,n,r)})),r(null,o)}).catch(t=>{r(t,null)})}static getRestaurantsData(t){var e=IDbOperationsHelper.openIDb("restaurants-data",1,"restaurants");e.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(n=>{n.length<=0?IDbOperationsHelper.getRestaurantsFromServer(e,"restaurants","readwrite",t):t(null,n)})}static updateRestaurantData(t){IDbOperationsHelper.openIDb("restaurants-data",1,"restaurants").then(e=>e.transaction("restaurants","readwrite").objectStore("restaurants").put(t)).then(t=>{console.log("test success"),console.log(t)}).catch(t=>{console.log("test failed"),console.log(t)})}static addMissingData(t){return isNaN(t.photograph)?t.photograph=t.id+".jpg":t.photograph=t.photograph+".jpg",t}}class DBHelper{static get NEW_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurantById(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.find(e=>e.id==t);n?e(null,n):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.cuisine_type==t);e(null,n)}})}static fetchRestaurantByNeighborhood(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.neighborhood==t);e(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,n){IDbOperationsHelper.getRestaurantsData((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),n(null,r)}})}static fetchNeighborhoods(t){IDbOperationsHelper.getRestaurantsData((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].neighborhood),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static fetchCuisines(t){IDbOperationsHelper.getRestaurantsData((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].cuisine_type),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}`}static mapMarkerForRestaurant(t,e){const n=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return n.addTo(newMap),n}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Q29udHJvbGxlci5qcyIsImlkYi5qcyIsIklEYk9wZXJhdGlvbnNIZWxwZXIuanMiLCJkYmhlbHBlci5qcyJdLCJuYW1lcyI6WyJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJ0aGVuIiwicmVnIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJBUElfVVJMIiwiZmV0Y2hTdGF0dXMiLCJJRGJPcGVyYXRpb25zSGVscGVyIiwiW29iamVjdCBPYmplY3RdIiwid2luZG93Iiwib2JqZWN0U3RvcmVOYW1lIiwidXBncmFkZURCIiwiYXV0b0luY3JlbWVudCIsImRiUHJvbWlzZSIsInBlcm1pc2lvbiIsImpzb25EYXRhIiwidHJhbnNhY3QiLCJwdXQiLCJyZXNwb25zZSIsInRyYW5zYWN0aW9uTmFtZSIsImFycnkiLCJzZXRSZXN0YXVyYW50c0RhdGEiLCJmZXRjaCIsImpzb24iLCJyZXNwb25zZUpzb24iLCJyZXN0YXVyYW50IiwiYWRkTWlzc2luZ0RhdGEiLCJyZXN0YXVyYW50RGF0YSIsImFkZFRvRGIiLCJvcGVuSURiIiwicmVzcG9uc2VPYmVqY3RzIiwiZ2V0UmVzdGF1cmFudHNGcm9tU2VydmVyIiwicmVzIiwicmVzdEpzb24iLCJpc05hTiIsInBob3RvZ3JhcGgiLCJpZCIsIkRCSGVscGVyIiwiTkVXX1VSTCIsImdldFJlc3RhdXJhbnRzRGF0YSIsInJlc3RhdXJhbnRzIiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsIm1hcmtlciIsIkwiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsImFsdCIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhZGRUbyIsIm5ld01hcCJdLCJtYXBwaW5ncyI6IkFBQUlBLFVBQVVDLGVBQ2JELFVBQVVDLGNBQWNDLFNBQVMsVUFBVUMsS0FBS0MsSUFDL0NDLFFBQVFDLElBQUksdUNBQ1ZDLE1BQU0sU0FBU0MsR0FDakJILFFBQVFDLElBQUlFLEtBTWIsV0FLQSxTQUFTQyxFQUFpQkMsR0FDekIsT0FBTyxJQUFJQyxRQUFRLFNBQVNDLEVBQVNDLEdBQ3BDSCxFQUFRSSxVQUFZLFdBQ25CRixFQUFRRixFQUFRSyxTQUdqQkwsRUFBUU0sUUFBVSxXQUNqQkgsRUFBT0gsRUFBUU8sVUFLbEIsU0FBU0MsRUFBcUJDLEVBQUtDLEVBQVFDLEdBQzFDLElBQUlYLEVBQ0FZLEVBQUksSUFBSVgsUUFBUSxTQUFTQyxFQUFTQyxHQUVyQ0osRUFEQUMsRUFBVVMsRUFBSUMsR0FBUUcsTUFBTUosRUFBS0UsSUFDUGxCLEtBQUtTLEVBQVNDLEtBSXpDLE9BREFTLEVBQUVaLFFBQVVBLEVBQ0xZLEVBV1IsU0FBU0UsRUFBZ0JDLEVBQVlDLEVBQVlDLEdBQ2hEQSxFQUFXQyxRQUFRLFNBQVNDLEdBQzNCQyxPQUFPQyxlQUFlTixFQUFXTyxVQUFXSCxFQUFNLENBQ2pESSxJQUFLLFdBQ0osT0FBT0MsS0FBS1IsR0FBWUcsSUFFekJNLElBQUssU0FBU0MsR0FDYkYsS0FBS1IsR0FBWUcsR0FBUU8sT0FNN0IsU0FBU0MsRUFBb0JaLEVBQVlDLEVBQVlZLEVBQWFYLEdBQ2pFQSxFQUFXQyxRQUFRLFNBQVNDLEdBQ3JCQSxLQUFRUyxFQUFZTixZQUMxQlAsRUFBV08sVUFBVUgsR0FBUSxXQUM1QixPQUFPWCxFQUFxQmdCLEtBQUtSLEdBQWFHLEVBQU1VLGVBS3ZELFNBQVNDLEVBQWFm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QWhCSSxJQUVISCxFQUFVQSxFQUFRQyxPQUFPSCxHQUFLQSxFQUFFSyxjQUFnQkEsSUFFakRwRSxFQUFTLEtBQU1pRSxNQVFsQnBDLDBCQUEwQjdCLEdBRXpCNEIsb0JBQW9CZ0MsbUJBQW1CLENBQUMzSCxFQUFPNEgsS0FDOUMsR0FBSTVILEVBQ0grRCxFQUFTL0QsRUFBTyxVQUNWLENBRU4sTUFBTW9JLEVBQWdCUixFQUFZUyxJQUNqQyxDQUFDQyxFQUFHQyxJQUFNWCxFQUFZVyxHQUFHSixjQUdwQkssRUFBc0JKLEVBQWNILE9BQ3pDLENBQUNLLEVBQUdDLElBQU1ILEVBQWNLLFFBQVFILElBQU1DLEdBRXZDeEUsRUFBUyxLQUFNeUUsTUFRbEI1QyxxQkFBcUI3QixHQUVwQjRCLG9CQUFvQmdDLG1CQUFtQixDQUFDM0gsRUFBTzRILEtBQzlDLEdBQUk1SCxFQUNIK0QsRUFBUy9ELEVBQU8sVUFDVixDQUVOLE1BQU0wSSxFQUFXZCxFQUFZUyxJQUFJLENBQUNDLEVBQUdDLElBQU1YLEVBQVlXLEdBQUdMLGNBRXBEUyxFQUFpQkQsRUFBU1QsT0FDL0IsQ0FBQ0ssRUFBR0MsSUFBTUcsRUFBU0QsUUFBUUgsSUFBTUMsR0FFbEN4RSxFQUFTLEtBQU00RSxNQVFsQi9DLHdCQUF3QmlCLEdBQ3ZCLDhCQUErQkEsRUFBV1csS0FNM0M1Qiw2QkFBNkJpQixHQUM1QixjQUFlQSxFQUFXVSxhQU0zQjNCLDhCQUE4QmlCLEVBQVl3QixHQUN6QyxNQUFNTyxFQUFTLElBQUlDLEVBQUVELE9BQ3BCLENBQUMvQixFQUFXaUMsT0FBT0MsSUFBS2xDLEVBQVdpQyxPQUFPRSxLQUMxQyxDQUNDQyxNQUFPcEMsRUFBV2hDLEtBQ2xCcUUsSUFBS3JDLEVBQVdoQyxLQUNoQnNFLElBQUsxQixTQUFTMkIsaUJBQWlCdkMsS0FJakMsT0FEQStCLEVBQU9TLE1BQU1DLFFBQ05WIiwic291cmNlc0NvbnRlbnQiOlsiaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG5cdG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKHJlZyA9PiB7XG5cdFx0Y29uc29sZS5sb2coJyoqKiBTZXJ2aWNlIFdvcmtlciByZWdpc3RlcmVkICoqKicpO1xuXHR9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcblx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHR9KTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuXHRmdW5jdGlvbiB0b0FycmF5KGFycikge1xuXHRcdHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0cmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG5cdFx0XHR9O1xuXG5cdFx0XHRyZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG5cdFx0dmFyIHJlcXVlc3Q7XG5cdFx0dmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuXHRcdFx0cHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG5cdFx0fSk7XG5cblx0XHRwLnJlcXVlc3QgPSByZXF1ZXN0O1xuXHRcdHJldHVybiBwO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcblx0XHR2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcblx0XHRyZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRpZiAoIXZhbHVlKSByZXR1cm47XG5cdFx0XHRyZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuXHRcdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuXHRcdFx0XHRcdHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuXHRcdHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG5cdFx0XHRpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblx0XHRcdFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuXHRcdHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG5cdFx0XHRpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblx0XHRcdFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuXHRcdHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG5cdFx0XHRpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblx0XHRcdFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG5cdFx0dGhpcy5faW5kZXggPSBpbmRleDtcblx0fVxuXG5cdHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcblx0XHQnbmFtZScsXG5cdFx0J2tleVBhdGgnLFxuXHRcdCdtdWx0aUVudHJ5Jyxcblx0XHQndW5pcXVlJ1xuXHRdKTtcblxuXHRwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcblx0XHQnZ2V0Jyxcblx0XHQnZ2V0S2V5Jyxcblx0XHQnZ2V0QWxsJyxcblx0XHQnZ2V0QWxsS2V5cycsXG5cdFx0J2NvdW50J1xuXHRdKTtcblxuXHRwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcblx0XHQnb3BlbkN1cnNvcicsXG5cdFx0J29wZW5LZXlDdXJzb3InXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcblx0XHR0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG5cdFx0dGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG5cdH1cblxuXHRwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcblx0XHQnZGlyZWN0aW9uJyxcblx0XHQna2V5Jyxcblx0XHQncHJpbWFyeUtleScsXG5cdFx0J3ZhbHVlJ1xuXHRdKTtcblxuXHRwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcblx0XHQndXBkYXRlJyxcblx0XHQnZGVsZXRlJ1xuXHRdKTtcblxuXHQvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuXHRbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG5cdFx0aWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBjdXJzb3IgPSB0aGlzO1xuXHRcdFx0dmFyIGFyZ3MgPSBhcmd1bWVudHM7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcblx0XHRcdFx0Y3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuXHRcdFx0XHRyZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdFx0XHRpZiAoIXZhbHVlKSByZXR1cm47XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fTtcblx0fSk7XG5cblx0ZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcblx0XHR0aGlzLl9zdG9yZSA9IHN0b3JlO1xuXHR9XG5cblx0T2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0T2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuXHRcdCduYW1lJyxcblx0XHQna2V5UGF0aCcsXG5cdFx0J2luZGV4TmFtZXMnLFxuXHRcdCdhdXRvSW5jcmVtZW50J1xuXHRdKTtcblxuXHRwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcblx0XHQncHV0Jyxcblx0XHQnYWRkJyxcblx0XHQnZGVsZXRlJyxcblx0XHQnY2xlYXInLFxuXHRcdCdnZXQnLFxuXHRcdCdnZXRBbGwnLFxuXHRcdCdnZXRLZXknLFxuXHRcdCdnZXRBbGxLZXlzJyxcblx0XHQnY291bnQnXG5cdF0pO1xuXG5cdHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuXHRcdCdvcGVuQ3Vyc29yJyxcblx0XHQnb3BlbktleUN1cnNvcidcblx0XSk7XG5cblx0cHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcblx0XHQnZGVsZXRlSW5kZXgnXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG5cdFx0dGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcblx0XHR0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdH07XG5cdFx0XHRpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG5cdFx0XHR9O1xuXHRcdFx0aWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuXHR9O1xuXG5cdHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcblx0XHQnb2JqZWN0U3RvcmVOYW1lcycsXG5cdFx0J21vZGUnXG5cdF0pO1xuXG5cdHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG5cdFx0J2Fib3J0J1xuXHRdKTtcblxuXHRmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG5cdFx0dGhpcy5fZGIgPSBkYjtcblx0XHR0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuXHRcdHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuXHR9XG5cblx0VXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuXHR9O1xuXG5cdHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG5cdFx0J25hbWUnLFxuXHRcdCd2ZXJzaW9uJyxcblx0XHQnb2JqZWN0U3RvcmVOYW1lcydcblx0XSk7XG5cblx0cHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG5cdFx0J2RlbGV0ZU9iamVjdFN0b3JlJyxcblx0XHQnY2xvc2UnXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIERCKGRiKSB7XG5cdFx0dGhpcy5fZGIgPSBkYjtcblx0fVxuXG5cdERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuXHR9O1xuXG5cdHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcblx0XHQnbmFtZScsXG5cdFx0J3ZlcnNpb24nLFxuXHRcdCdvYmplY3RTdG9yZU5hbWVzJ1xuXHRdKTtcblxuXHRwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuXHRcdCdjbG9zZSdcblx0XSk7XG5cblx0Ly8gQWRkIGN1cnNvciBpdGVyYXRvcnNcblx0Ly8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuXHRbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcblx0XHRbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG5cdFx0XHQvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG5cdFx0XHRpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cblx0XHRcdENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG5cdFx0XHRcdHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcblx0XHRcdFx0dmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuXHRcdFx0XHR2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG5cdFx0XHRcdHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fSk7XG5cblx0Ly8gcG9seWZpbGwgZ2V0QWxsXG5cdFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcblx0XHRpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuXHRcdENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcblx0XHRcdHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cdFx0XHR2YXIgaXRlbXMgPSBbXTtcblxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdFx0aW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG5cdFx0XHRcdFx0aWYgKCFjdXJzb3IpIHtcblx0XHRcdFx0XHRcdHJlc29sdmUoaXRlbXMpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cblx0XHRcdFx0XHRpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcblx0XHRcdFx0XHRcdHJlc29sdmUoaXRlbXMpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRjdXJzb3IuY29udGludWUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KTtcblxuXHR2YXIgZXhwID0ge1xuXHRcdG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuXHRcdFx0dmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcblx0XHRcdHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG5cdFx0XHRpZiAocmVxdWVzdCkge1xuXHRcdFx0XHRyZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHRcdFx0aWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuXHRcdFx0XHRcdFx0dXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBEQihkYik7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0cmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcblx0XHR9XG5cdH07XG5cblx0aWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBleHA7XG5cdFx0bW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdGVsc2Uge1xuXHRcdHNlbGYuaWRiID0gZXhwO1xuXHR9XG59KCkpO1xuIiwidmFyIEFQSV9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzJztcbnZhciBmZXRjaFN0YXR1cyA9IDA7XG5cbi8vIEhlbHBlciBGdW5jdGlvbnMgZm9yIHZhcmlvdXMgSURiIE9wZXJhdGlvbnNcbmNsYXNzIElEYk9wZXJhdGlvbnNIZWxwZXIge1xuXHRzdGF0aWMgY2hlY2tGb3JJRGJTdXBwb3J0KCkge1xuXHRcdGlmICghKCdpbmRleGVkREInIGluIHdpbmRvdykpIHtcblx0XHRcdHJldHVybiAwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gMTtcblx0XHR9XG5cdH1cblxuXHRzdGF0aWMgb3BlbklEYihuYW1lLCB2ZXJzaW9uLCBvYmplY3RTdG9yZU5hbWUpIHtcblx0XHR2YXIgZGJQcm9taXNlID0gaWRiLm9wZW4obmFtZSwgdmVyc2lvbiwgdXBncmFkZURCID0+IHtcblx0XHRcdHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUsIHsgYXV0b0luY3JlbWVudDogdHJ1ZSB9KTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZGJQcm9taXNlO1xuXHR9XG5cblx0c3RhdGljIGFkZFRvRGIoZGJQcm9taXNlLCBvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbiwganNvbkRhdGEpIHtcblx0XHRkYlByb21pc2UudGhlbihkYiA9PiB7XG5cdFx0XHR2YXIgdHJhbnNhY3QgPSBkYi50cmFuc2FjdGlvbihvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbik7XG5cdFx0XHQvL0FkZCBhbGwgdGhlIGpzb24gY29udGVudCBoZXJlXG5cdFx0XHR0cmFuc2FjdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUpLnB1dChqc29uRGF0YSk7XG5cdFx0XHRyZXR1cm4gdHJhbnNhY3QuY29tcGxldGU7XG5cdFx0fSkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnUmVzdGF1cmFudCBzYXZlZCB0byBJREInKTtcblx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRBbGxEYXRhKGRiUHJvbWlzZSwgdHJhbnNhY3Rpb25OYW1lLCBvYmplY3RTdG9yZU5hbWUpIHtcblx0XHR2YXIgcmVzcG9uc2VBcnJheVByb21pc2UgPSBkYlByb21pc2UudGhlbihkYiA9PiBkYlxuXHRcdFx0LnRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uTmFtZSlcblx0XHRcdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUpXG5cdFx0XHQuZ2V0QWxsKClcblx0XHQpO1xuXHRcdHJlc3BvbnNlQXJyYXlQcm9taXNlLnRoZW4oYXJyeSA9PiB7XG5cdFx0XHRJRGJPcGVyYXRpb25zSGVscGVyLnNldFJlc3RhdXJhbnRzRGF0YShhcnJ5KTtcblx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50c0Zyb21TZXJ2ZXIoZGJQcm9taXNlLCBvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbiwgY2FsbGJhY2spIHtcblx0XHRmZXRjaChBUElfVVJMKVxuXHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuXHRcdFx0LnRoZW4ocmVzcG9uc2VKc29uID0+IHtcblx0XHRcdFx0cmVzcG9uc2VKc29uLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG5cdFx0XHRcdFx0cmVzdGF1cmFudCA9IElEYk9wZXJhdGlvbnNIZWxwZXIuYWRkTWlzc2luZ0RhdGEocmVzdGF1cmFudCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChmZXRjaFN0YXR1cyAhPSAxKSB7XG5cdFx0XHRcdFx0ZmV0Y2hTdGF0dXMgPSAxO1xuXHRcdFx0XHRcdHJlc3BvbnNlSnNvbi5mb3JFYWNoKHJlc3RhdXJhbnREYXRhID0+IHtcblxuXHRcdFx0XHRcdFx0Ly9BZGQgZXZlcnkgc2luZ2xlIHJlc3RhdXJhbnQgZGF0YSB0byBJRGJcblx0XHRcdFx0XHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuYWRkVG9EYihcblx0XHRcdFx0XHRcdFx0ZGJQcm9taXNlLFxuXHRcdFx0XHRcdFx0XHRvYmplY3RTdG9yZU5hbWUsXG5cdFx0XHRcdFx0XHRcdHBlcm1pc2lvbixcblx0XHRcdFx0XHRcdFx0cmVzdGF1cmFudERhdGFcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBjb25zb2xlLmxvZyhyZXNwb25zZUpzb24pO1xuXHRcdFx0XHRjYWxsYmFjayAobnVsbCwgcmVzcG9uc2VKc29uKTtcblx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coYFVuYWJsZSB0byBmZXRjaCByZXN0YXVyYW50cywgRXJyb3I6ICR7ZXJyb3J9YCk7XG5cdFx0XHRcdGNhbGxiYWNrIChlcnJvciwgbnVsbCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50c0RhdGEoY2FsbGJhY2spIHtcblx0XHR2YXIgaWRiTmFtZSA9ICdyZXN0YXVyYW50cy1kYXRhJztcblx0XHR2YXIgZGJWZXJzaW9uID0gMTtcblx0XHR2YXIgb2JqZWN0U3RvcmVOYW1lU3RyaW5nID0gJ3Jlc3RhdXJhbnRzJztcblx0XHR2YXIgdHJhbnNhY3Rpb25OYW1lU3RyaW5nID0gJ3Jlc3RhdXJhbnRzJztcblx0XHR2YXIgZGJQZXJtaXNzaW9uID0gJ3JlYWR3cml0ZSc7XG5cblx0XHR2YXIgZGJQcm9taXNlID0gSURiT3BlcmF0aW9uc0hlbHBlci5vcGVuSURiKFxuXHRcdFx0aWRiTmFtZSxcblx0XHRcdGRiVmVyc2lvbixcblx0XHRcdG9iamVjdFN0b3JlTmFtZVN0cmluZ1xuXHRcdCk7XG5cblx0XHRkYlByb21pc2UudGhlbihkYiA9PlxuXHRcdFx0ZGIudHJhbnNhY3Rpb24odHJhbnNhY3Rpb25OYW1lU3RyaW5nKVxuXHRcdFx0XHQub2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lU3RyaW5nKVxuXHRcdFx0XHQuZ2V0QWxsKClcblx0XHQpLnRoZW4ocmVzcG9uc2VPYmVqY3RzID0+IHtcblx0XHRcdGlmIChyZXNwb25zZU9iZWpjdHMubGVuZ3RoIDw9IDApIHtcblx0XHRcdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0Zyb21TZXJ2ZXIoXG5cdFx0XHRcdFx0ZGJQcm9taXNlLFxuXHRcdFx0XHRcdG9iamVjdFN0b3JlTmFtZVN0cmluZyxcblx0XHRcdFx0XHRkYlBlcm1pc3Npb24sXG5cdFx0XHRcdFx0Y2FsbGJhY2tcblx0XHRcdFx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlT2JlamN0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKiBGQUlMRUQ6OjogRnVuY3Rpb24gdG8gdXBkYXRlIHRoZSBSZXN0YXVyYW50IGRhdGEqL1xuXHRzdGF0aWMgdXBkYXRlUmVzdGF1cmFudERhdGEocmVzdGF1cmFudCkge1xuXHRcdHZhciBpZGJOYW1lID0gJ3Jlc3RhdXJhbnRzLWRhdGEnO1xuXHRcdHZhciBkYlZlcnNpb24gPSAxO1xuXHRcdHZhciBvYmplY3RTdG9yZU5hbWUgPSAncmVzdGF1cmFudHMnO1xuXHRcdHZhciB0cmFuc2FjdGlvbk5hbWUgPSAncmVzdGF1cmFudHMnO1xuXHRcdHZhciBkYlBlcm1pc3Npb24gPSAncmVhZHdyaXRlJztcblxuXHRcdHZhciBkYlByb21pc2UgPSBJRGJPcGVyYXRpb25zSGVscGVyLm9wZW5JRGIoXG5cdFx0XHRpZGJOYW1lLFxuXHRcdFx0ZGJWZXJzaW9uLFxuXHRcdFx0b2JqZWN0U3RvcmVOYW1lXG5cdFx0KTtcblxuXHRcdC8qIFB1dCBKU09OIGRhdGEgdG8gaW5kZXhEQiovXG5cdFx0ZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuXHRcdFx0IHJldHVybiBkYi50cmFuc2FjdGlvbihvYmplY3RTdG9yZU5hbWUsIGRiUGVybWlzc2lvbilcblx0XHRcdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUpXG5cdFx0XHQucHV0KHJlc3RhdXJhbnQpXG5cdFx0fVxuXHRcdCkudGhlbihyZXMgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coJ3Rlc3Qgc3VjY2VzcycpO1xuXHRcdFx0Y29uc29sZS5sb2cocmVzKTtcblx0XHR9KS5jYXRjaChlcnIgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coJ3Rlc3QgZmFpbGVkJyk7XG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdH0pO1xuXHR9XG5cblx0Ly8gSGFuZGxlIGZvciBsYXN0IGVudHJ5IG9uIFJlc3RhdXJhbnRzIExpc3Rcblx0c3RhdGljIGFkZE1pc3NpbmdEYXRhKHJlc3RKc29uKSB7XG5cdFx0aWYgKCFpc05hTihyZXN0SnNvbi5waG90b2dyYXBoKSkge1xuXHRcdFx0cmVzdEpzb24ucGhvdG9ncmFwaCA9IHJlc3RKc29uLnBob3RvZ3JhcGggKyAnLmpwZyc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc3RKc29uWydwaG90b2dyYXBoJ10gPSByZXN0SnNvbi5pZCArICcuanBnJztcblx0XHR9XG5cdFx0cmV0dXJuIHJlc3RKc29uO1xuXHR9XG59XG4iLCIvLyBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbmNsYXNzIERCSGVscGVyIHtcblx0c3RhdGljIGdldCBORVdfVVJMKCkge1xuXHRcdHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzJztcblx0fVxuXHQvKipcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcblx0XHQvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XG5cdFx0XHRcdGlmIChyZXN0YXVyYW50KSB7XG5cdFx0XHRcdFx0Ly8gR290IHRoZSByZXN0YXVyYW50XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2Vcblx0XHRcdFx0XHRjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxuXHRcdGN1aXNpbmUsXG5cdFx0bmVpZ2hib3Job29kLFxuXHRcdGNhbGxiYWNrXG5cdCkge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuXHRcdFx0XHRpZiAoY3Vpc2luZSAhPSAnYWxsJykge1xuXHRcdFx0XHRcdC8vIGZpbHRlciBieSBjdWlzaW5lXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykge1xuXHRcdFx0XHRcdC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHRcdGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoXG5cdFx0XHRcdFx0KHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZFxuXHRcdFx0XHQpO1xuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcblx0XHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxuXHRcdFx0XHRcdCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuXHRcdFx0XHRjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihcblx0XHRcdFx0XHQodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpXG5cdFx0XHRcdCk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAgICovXG5cdHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcblx0XHRyZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gO1xuXHR9XG5cblx0LyoqXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAgICovXG5cdHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuXHRcdHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH1gO1xuXHR9XG5cblx0LyoqXG4gICAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgICAqL1xuXHRzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgTC5tYXJrZXIoXG5cdFx0XHRbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuXHRcdFx0e1xuXHRcdFx0XHR0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuXHRcdFx0XHRhbHQ6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdFx0dXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXG5cdFx0XHR9XG5cdFx0KTtcblx0XHRtYXJrZXIuYWRkVG8obmV3TWFwKTtcblx0XHRyZXR1cm4gbWFya2VyO1xuXHR9XG59XG4iXSwiZmlsZSI6ImFwcC1taW4uanMifQ==

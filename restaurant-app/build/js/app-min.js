navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(t){console.log("Worker registered!"),console.log(t)}).catch(function(t){console.log(t)}),function(){function t(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function e(e,n,r){var o,a=new Promise(function(a,s){t(o=e[n].apply(e,r)).then(a,s)});return a.request=o,a}function n(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function r(t,n,r,o){o.forEach(function(o){o in r.prototype&&(t.prototype[o]=function(){return e(this[n],o,arguments)})})}function o(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function a(t,n,r,o){o.forEach(function(o){o in r.prototype&&(t.prototype[o]=function(){return t=this[n],(r=e(t,o,arguments)).then(function(t){if(t)return new i(t,r.request)});var t,r})})}function s(t){this._index=t}function i(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function c(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new c(n)}function p(t){this._db=t}n(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(i,"_cursor",["direction","key","primaryKey","value"]),r(i,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(i.prototype[e]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,r),t(n._request).then(function(t){if(t)return new i(t,n._request)})})})}),u.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},n(u,"_store",["name","keyPath","indexNames","autoIncrement"]),r(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},n(c,"_tx",["objectStoreNames","mode"]),o(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),o(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[u,s].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,n=(e=arguments,Array.prototype.slice.call(e)),r=n[n.length-1],o=this._store||this._index,a=o[t].apply(o,n.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[s,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(o){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():o(r)):o(r)})})})});var h={open:function(t,n,r){var o=e(indexedDB,"open",[t,n]),a=o.request;return a&&(a.onupgradeneeded=function(t){r&&r(new l(a.result,t.oldVersion,a.transaction))}),o.then(function(t){return new p(t)})},delete:function(t){return e(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof module?(module.exports=h,module.exports.default=module.exports):self.idb=h}();var API_URL="http://localhost:1337/restaurants",fetchStatus=0;class IDbOperationsHelper{static checkForIDbSupport(){return"indexedDB"in window?1:0}static openIDb(t,e,n){return idb.open(t,e,t=>{t.createObjectStore(n,{autoIncrement:!0})})}static addToDb(t,e,n,r){t.then(t=>{var o=t.transaction(e,n);return o.objectStore(e).put(r),o.complete}).then(t=>{console.log("Restaurant saved to IDb")})}static getAllData(t,e,n){t.then(t=>t.transaction(e).objectStore(n).getAll()).then(t=>{IDbOperationsHelper.setRestaurantsData(t)})}static getRestaurantsFromServer(t,e,n,r){fetch(API_URL).then(t=>t.json()).then(o=>{o.forEach(t=>{t=IDbOperationsHelper.addMissingData(t)}),1!=fetchStatus&&(fetchStatus=1,o.forEach(r=>{IDbOperationsHelper.addToDb(t,e,n,r)})),console.log(o),r(null,o)}).catch(t=>{console.log(`Unable to fetch restaurants, Error: ${t}`),r(t,null)})}static getRestaurantsData(t){var e=IDbOperationsHelper.openIDb("restaurants-data",1,"restaurants");e.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(n=>{n.length<=0?IDbOperationsHelper.getRestaurantsFromServer(e,"restaurants","readwrite",t):t(null,n)})}static addMissingData(t){return isNaN(t.photograph)?t.photograph=t.id+".jpg":t.photograph=t.photograph+".jpg",t}}class DBHelper{static get NEW_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurantById(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.find(e=>e.id==t);n?e(null,n):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.cuisine_type==t);e(null,n)}})}static fetchRestaurantByNeighborhood(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.neighborhood==t);e(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,n){IDbOperationsHelper.getRestaurantsData((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),n(null,r)}})}static fetchNeighborhoods(t){IDbOperationsHelper.getRestaurantsData((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].neighborhood),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static fetchCuisines(t){IDbOperationsHelper.getRestaurantsData((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].cuisine_type),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}`}static mapMarkerForRestaurant(t,e){const n=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return n.addTo(newMap),n}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Q29udHJvbGxlci5qcyIsImlkYi5qcyIsIklEYk9wZXJhdGlvbnNIZWxwZXIuanMiLCJkYmhlbHBlci5qcyJdLCJuYW1lcyI6WyJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJ0aGVuIiwicmVnIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJBUElfVVJMIiwiZmV0Y2hTdGF0dXMiLCJJRGJPcGVyYXRpb25zSGVscGVyIiwiW29iamVjdCBPYmplY3RdIiwid2luZG93Iiwib2JqZWN0U3RvcmVOYW1lIiwidXBncmFkZURCIiwiYXV0b0luY3JlbWVudCIsImRiUHJvbWlzZSIsInBlcm1pc2lvbiIsImpzb25EYXRhIiwidHJhbnNhY3QiLCJwdXQiLCJyZXNwb25zZSIsInRyYW5zYWN0aW9uTmFtZSIsImFycnkiLCJzZXRSZXN0YXVyYW50c0RhdGEiLCJmZXRjaCIsImpzb24iLCJyZXNwb25zZUpzb24iLCJyZXN0YXVyYW50IiwiYWRkTWlzc2luZ0RhdGEiLCJyZXN0YXVyYW50RGF0YSIsImFkZFRvRGIiLCJvcGVuSURiIiwicmVzcG9uc2VPYmVqY3RzIiwiZ2V0UmVzdGF1cmFudHNGcm9tU2VydmVyIiwicmVzdEpzb24iLCJpc05hTiIsInBob3RvZ3JhcGgiLCJpZCIsIkRCSGVscGVyIiwiTkVXX1VSTCIsImdldFJlc3RhdXJhbnRzRGF0YSIsInJlc3RhdXJhbnRzIiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsIm1hcmtlciIsIkwiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsImFsdCIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhZGRUbyIsIm5ld01hcCJdLCJtYXBwaW5ncyI6IkFBQUlBLFVBQVVDLGVBQ2JELFVBQVVDLGNBQWNDLFNBQVMsVUFBVUMsS0FBSyxTQUFTQyxHQUN4REMsUUFBUUMsSUFBSSxzQkFDWkQsUUFBUUMsSUFBSUYsS0FDVkcsTUFBTSxTQUFTQyxHQUNqQkgsUUFBUUMsSUFBSUUsS0FNYixXQUtBLFNBQVNDLEVBQWlCQyxHQUN6QixPQUFPLElBQUlDLFFBQVEsU0FBU0MsRUFBU0MsR0FDcENILEVBQVFJLFVBQVksV0FDbkJGLEVBQVFGLEVBQVFLLFNBR2pCTCxFQUFRTSxRQUFVLFdBQ2pCSCxFQUFPSCxFQUFRTyxVQUtsQixTQUFTQyxFQUFxQkMsRUFBS0MsRUFBUUMsR0FDMUMsSUFBSVgsRUFDQVksRUFBSSxJQUFJWCxRQUFRLFNBQVNDLEVBQVNDLEdBRXJDSixFQURBQyxFQUFVUyxFQUFJQyxHQUFRRyxNQUFNSixFQUFLRSxJQUNQbEIsS0FBS1MsRUFBU0MsS0FJekMsT0FEQVMsRUFBRVosUUFBVUEsRUFDTFksRUFXUixTQUFTRSxFQUFnQkMsRUFBWUMsRUFBWUMsR0FDaERBLEVBQVdDLFFBQVEsU0FBU0MsR0FDM0JDLE9BQU9DLGVBQWVOLEVBQVdPLFVBQVdILEVBQU0sQ0FDakRJLElBQUssV0FDSixPQUFPQyxLQUFLUixHQUFZRyxJQUV6Qk0sSUFBSyxTQUFTQyxHQUNiRixLQUFLUixHQUFZRyxHQUFRTyxPQU03QixTQUFTQyxFQUFvQlosRUFBWUMsRUFBWVksRUFBYVgsR0FDakVBLEVBQVdDLFFBQVEsU0FBU0MsR0FDckJBLEtBQVFTLEVBQVlOLFlBQzFCUCxFQUFXTyxVQUFVSCxHQUFRLFdBQzVCLE9BQU9YLEVBQXFCZ0IsS0FBS1IsR0FBYUcsRUFBTVUs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LFVBQ1YsQ0FFTixNQUFNbUksRUFBZ0JSLEVBQVlTLElBQ2pDLENBQUNDLEVBQUdDLElBQU1YLEVBQVlXLEdBQUdKLGNBR3BCSyxFQUFzQkosRUFBY0gsT0FDekMsQ0FBQ0ssRUFBR0MsSUFBTUgsRUFBY0ssUUFBUUgsSUFBTUMsR0FFdkN2RSxFQUFTLEtBQU13RSxNQVFsQjNDLHFCQUFxQjdCLEdBRXBCNEIsb0JBQW9CK0IsbUJBQW1CLENBQUMxSCxFQUFPMkgsS0FDOUMsR0FBSTNILEVBQ0grRCxFQUFTL0QsRUFBTyxVQUNWLENBRU4sTUFBTXlJLEVBQVdkLEVBQVlTLElBQUksQ0FBQ0MsRUFBR0MsSUFBTVgsRUFBWVcsR0FBR0wsY0FFcERTLEVBQWlCRCxFQUFTVCxPQUMvQixDQUFDSyxFQUFHQyxJQUFNRyxFQUFTRCxRQUFRSCxJQUFNQyxHQUVsQ3ZFLEVBQVMsS0FBTTJFLE1BUWxCOUMsd0JBQXdCaUIsR0FDdkIsOEJBQStCQSxFQUFXVSxLQU0zQzNCLDZCQUE2QmlCLEdBQzVCLGNBQWVBLEVBQVdTLGFBTTNCMUIsOEJBQThCaUIsRUFBWXVCLEdBQ3pDLE1BQU1PLEVBQVMsSUFBSUMsRUFBRUQsT0FDcEIsQ0FBQzlCLEVBQVdnQyxPQUFPQyxJQUFLakMsRUFBV2dDLE9BQU9FLEtBQzFDLENBQ0NDLE1BQU9uQyxFQUFXaEMsS0FDbEJvRSxJQUFLcEMsRUFBV2hDLEtBQ2hCcUUsSUFBSzFCLFNBQVMyQixpQkFBaUJ0QyxLQUlqQyxPQURBOEIsRUFBT1MsTUFBTUMsUUFDTlYiLCJzb3VyY2VzQ29udGVudCI6WyJpZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcblx0bmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24ocmVnKSB7XG5cdFx0Y29uc29sZS5sb2coJ1dvcmtlciByZWdpc3RlcmVkIScpO1xuXHRcdGNvbnNvbGUubG9nKHJlZyk7XG5cdH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuXHRcdGNvbnNvbGUubG9nKGVycik7XG5cdH0pO1xufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG5cdGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG5cdFx0cmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRyZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcblx0XHRcdH07XG5cblx0XHRcdHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZWplY3QocmVxdWVzdC5lcnJvcik7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcblx0XHR2YXIgcmVxdWVzdDtcblx0XHR2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0cmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG5cdFx0XHRwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcblx0XHR9KTtcblxuXHRcdHAucmVxdWVzdCA9IHJlcXVlc3Q7XG5cdFx0cmV0dXJuIHA7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuXHRcdHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuXHRcdHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdGlmICghdmFsdWUpIHJldHVybjtcblx0XHRcdHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcblx0XHRwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG5cdFx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldDogZnVuY3Rpb24odmFsKSB7XG5cdFx0XHRcdFx0dGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdFx0UHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdFx0UHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcblx0XHRcdH07XG5cdFx0fSk7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdFx0UHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcblx0XHR0aGlzLl9pbmRleCA9IGluZGV4O1xuXHR9XG5cblx0cHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuXHRcdCduYW1lJyxcblx0XHQna2V5UGF0aCcsXG5cdFx0J211bHRpRW50cnknLFxuXHRcdCd1bmlxdWUnXG5cdF0pO1xuXG5cdHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuXHRcdCdnZXQnLFxuXHRcdCdnZXRLZXknLFxuXHRcdCdnZXRBbGwnLFxuXHRcdCdnZXRBbGxLZXlzJyxcblx0XHQnY291bnQnXG5cdF0pO1xuXG5cdHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuXHRcdCdvcGVuQ3Vyc29yJyxcblx0XHQnb3BlbktleUN1cnNvcidcblx0XSk7XG5cblx0ZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuXHRcdHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcblx0XHR0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcblx0fVxuXG5cdHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuXHRcdCdkaXJlY3Rpb24nLFxuXHRcdCdrZXknLFxuXHRcdCdwcmltYXJ5S2V5Jyxcblx0XHQndmFsdWUnXG5cdF0pO1xuXG5cdHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuXHRcdCd1cGRhdGUnLFxuXHRcdCdkZWxldGUnXG5cdF0pO1xuXG5cdC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG5cdFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcblx0XHRpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG5cdFx0Q3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGN1cnNvciA9IHRoaXM7XG5cdFx0XHR2YXIgYXJncyA9IGFyZ3VtZW50cztcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG5cdFx0XHRcdHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRcdGlmICghdmFsdWUpIHJldHVybjtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KTtcblxuXHRmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuXHRcdHRoaXMuX3N0b3JlID0gc3RvcmU7XG5cdH1cblxuXHRPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcblx0fTtcblxuXHRPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcblx0fTtcblxuXHRwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG5cdFx0J25hbWUnLFxuXHRcdCdrZXlQYXRoJyxcblx0XHQnaW5kZXhOYW1lcycsXG5cdFx0J2F1dG9JbmNyZW1lbnQnXG5cdF0pO1xuXG5cdHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuXHRcdCdwdXQnLFxuXHRcdCdhZGQnLFxuXHRcdCdkZWxldGUnLFxuXHRcdCdjbGVhcicsXG5cdFx0J2dldCcsXG5cdFx0J2dldEFsbCcsXG5cdFx0J2dldEtleScsXG5cdFx0J2dldEFsbEtleXMnLFxuXHRcdCdjb3VudCdcblx0XSk7XG5cblx0cHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG5cdFx0J29wZW5DdXJzb3InLFxuXHRcdCdvcGVuS2V5Q3Vyc29yJ1xuXHRdKTtcblxuXHRwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuXHRcdCdkZWxldGVJbmRleCdcblx0XSk7XG5cblx0ZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcblx0XHR0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuXHRcdHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fTtcblx0XHRcdGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcblx0XHRcdH07XG5cdFx0XHRpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0VHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuXHRcdCdvYmplY3RTdG9yZU5hbWVzJyxcblx0XHQnbW9kZSdcblx0XSk7XG5cblx0cHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcblx0XHQnYWJvcnQnXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcblx0XHR0aGlzLl9kYiA9IGRiO1xuXHRcdHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG5cdFx0dGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG5cdH1cblxuXHRVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcblx0XHQnbmFtZScsXG5cdFx0J3ZlcnNpb24nLFxuXHRcdCdvYmplY3RTdG9yZU5hbWVzJ1xuXHRdKTtcblxuXHRwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcblx0XHQnZGVsZXRlT2JqZWN0U3RvcmUnLFxuXHRcdCdjbG9zZSdcblx0XSk7XG5cblx0ZnVuY3Rpb24gREIoZGIpIHtcblx0XHR0aGlzLl9kYiA9IGRiO1xuXHR9XG5cblx0REIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuXHRcdCduYW1lJyxcblx0XHQndmVyc2lvbicsXG5cdFx0J29iamVjdFN0b3JlTmFtZXMnXG5cdF0pO1xuXG5cdHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG5cdFx0J2Nsb3NlJ1xuXHRdKTtcblxuXHQvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuXHQvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG5cdFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuXHRcdFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcblx0XHRcdC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cblx0XHRcdGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuXHRcdFx0Q29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcblx0XHRcdFx0dmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuXHRcdFx0XHR2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG5cdFx0XHRcdHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcblx0XHRcdFx0cmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG5cdFx0XHRcdH07XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyBwb2x5ZmlsbCBnZXRBbGxcblx0W0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuXHRcdGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG5cdFx0Q29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuXHRcdFx0dmFyIGluc3RhbmNlID0gdGhpcztcblx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuXHRcdFx0XHRpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcblx0XHRcdFx0XHRpZiAoIWN1cnNvcikge1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShpdGVtcyk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuXHRcdFx0XHRcdGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShpdGVtcyk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGN1cnNvci5jb250aW51ZSgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH07XG5cdH0pO1xuXG5cdHZhciBleHAgPSB7XG5cdFx0b3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuXHRcdFx0dmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cblx0XHRcdGlmIChyZXF1ZXN0KSB7XG5cdFx0XHRcdHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdFx0XHRpZiAodXBncmFkZUNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHR1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuXHRcdFx0XHRyZXR1cm4gbmV3IERCKGRiKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0ZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRyZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuXHRcdH1cblx0fTtcblxuXHRpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGV4cDtcblx0XHRtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0ZWxzZSB7XG5cdFx0c2VsZi5pZGIgPSBleHA7XG5cdH1cbn0oKSk7XG4iLCJ2YXIgQVBJX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMnO1xudmFyIGZldGNoU3RhdHVzID0gMDtcblxuLy8gSGVscGVyIEZ1bmN0aW9ucyBmb3IgdmFyaW91cyBJRGIgT3BlcmF0aW9uc1xuY2xhc3MgSURiT3BlcmF0aW9uc0hlbHBlciB7XG5cdHN0YXRpYyBjaGVja0ZvcklEYlN1cHBvcnQoKSB7XG5cdFx0aWYgKCEoJ2luZGV4ZWREQicgaW4gd2luZG93KSkge1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiAxO1xuXHRcdH1cblx0fVxuXG5cdHN0YXRpYyBvcGVuSURiKG5hbWUsIHZlcnNpb24sIG9iamVjdFN0b3JlTmFtZSkge1xuXHRcdHZhciBkYlByb21pc2UgPSBpZGIub3BlbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlREIgPT4ge1xuXHRcdFx0dXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKG9iamVjdFN0b3JlTmFtZSwgeyBhdXRvSW5jcmVtZW50OiB0cnVlIH0pO1xuXHRcdH0pO1xuXHRcdHJldHVybiBkYlByb21pc2U7XG5cdH1cblxuXHRzdGF0aWMgYWRkVG9EYihkYlByb21pc2UsIG9iamVjdFN0b3JlTmFtZSwgcGVybWlzaW9uLCBqc29uRGF0YSkge1xuXHRcdGRiUHJvbWlzZS50aGVuKGRiID0+IHtcblx0XHRcdHZhciB0cmFuc2FjdCA9IGRiLnRyYW5zYWN0aW9uKG9iamVjdFN0b3JlTmFtZSwgcGVybWlzaW9uKTtcblx0XHRcdC8vQWRkIGFsbCB0aGUganNvbiBjb250ZW50IGhlcmVcblx0XHRcdHRyYW5zYWN0Lm9iamVjdFN0b3JlKG9iamVjdFN0b3JlTmFtZSkucHV0KGpzb25EYXRhKTtcblx0XHRcdHJldHVybiB0cmFuc2FjdC5jb21wbGV0ZTtcblx0XHR9KS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdGNvbnNvbGUubG9nKCdSZXN0YXVyYW50IHNhdmVkIHRvIElEYicpO1xuXHRcdH0pO1xuXHR9XG5cblx0c3RhdGljIGdldEFsbERhdGEoZGJQcm9taXNlLCB0cmFuc2FjdGlvbk5hbWUsIG9iamVjdFN0b3JlTmFtZSkge1xuXHRcdHZhciByZXNwb25zZUFycmF5UHJvbWlzZSA9IGRiUHJvbWlzZS50aGVuKGRiID0+IGRiXG5cdFx0XHQudHJhbnNhY3Rpb24odHJhbnNhY3Rpb25OYW1lKVxuXHRcdFx0Lm9iamVjdFN0b3JlKG9iamVjdFN0b3JlTmFtZSlcblx0XHRcdC5nZXRBbGwoKVxuXHRcdCk7XG5cdFx0cmVzcG9uc2VBcnJheVByb21pc2UudGhlbihhcnJ5ID0+IHtcblx0XHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuc2V0UmVzdGF1cmFudHNEYXRhKGFycnkpO1xuXHRcdH0pO1xuXHR9XG5cblx0c3RhdGljIGdldFJlc3RhdXJhbnRzRnJvbVNlcnZlcihkYlByb21pc2UsIG9iamVjdFN0b3JlTmFtZSwgcGVybWlzaW9uLCBjYWxsYmFjaykge1xuXHRcdGZldGNoKEFQSV9VUkwpXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG5cdFx0XHQudGhlbihyZXNwb25zZUpzb24gPT4ge1xuXHRcdFx0XHRyZXNwb25zZUpzb24uZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcblx0XHRcdFx0XHRyZXN0YXVyYW50ID0gSURiT3BlcmF0aW9uc0hlbHBlci5hZGRNaXNzaW5nRGF0YShyZXN0YXVyYW50KTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKGZldGNoU3RhdHVzICE9IDEpIHtcblx0XHRcdFx0XHRmZXRjaFN0YXR1cyA9IDE7XG5cdFx0XHRcdFx0cmVzcG9uc2VKc29uLmZvckVhY2gocmVzdGF1cmFudERhdGEgPT4ge1xuXG5cdFx0XHRcdFx0XHQvL0FkZCBldmVyeSBzaW5nbGUgcmVzdGF1cmFudCBkYXRhIHRvIElEYlxuXHRcdFx0XHRcdFx0SURiT3BlcmF0aW9uc0hlbHBlci5hZGRUb0RiKFxuXHRcdFx0XHRcdFx0XHRkYlByb21pc2UsXG5cdFx0XHRcdFx0XHRcdG9iamVjdFN0b3JlTmFtZSxcblx0XHRcdFx0XHRcdFx0cGVybWlzaW9uLFxuXHRcdFx0XHRcdFx0XHRyZXN0YXVyYW50RGF0YVxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnNvbGUubG9nKHJlc3BvbnNlSnNvbik7XG5cdFx0XHRcdGNhbGxiYWNrIChudWxsLCByZXNwb25zZUpzb24pO1xuXHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhgVW5hYmxlIHRvIGZldGNoIHJlc3RhdXJhbnRzLCBFcnJvcjogJHtlcnJvcn1gKTtcblx0XHRcdFx0Y2FsbGJhY2sgKGVycm9yLCBudWxsKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0c3RhdGljIGdldFJlc3RhdXJhbnRzRGF0YShjYWxsYmFjaykge1xuXHRcdHZhciBpZGJOYW1lID0gJ3Jlc3RhdXJhbnRzLWRhdGEnO1xuXHRcdHZhciBkYlZlcnNpb24gPSAxO1xuXHRcdHZhciBvYmplY3RTdG9yZU5hbWVTdHJpbmcgPSAncmVzdGF1cmFudHMnO1xuXHRcdHZhciB0cmFuc2FjdGlvbk5hbWVTdHJpbmcgPSAncmVzdGF1cmFudHMnO1xuXHRcdHZhciBkYlBlcm1pc3Npb24gPSAncmVhZHdyaXRlJztcblxuXHRcdHZhciBkYlByb21pc2UgPSBJRGJPcGVyYXRpb25zSGVscGVyLm9wZW5JRGIoXG5cdFx0XHRpZGJOYW1lLFxuXHRcdFx0ZGJWZXJzaW9uLFxuXHRcdFx0b2JqZWN0U3RvcmVOYW1lU3RyaW5nXG5cdFx0KTtcblxuXHRcdGRiUHJvbWlzZS50aGVuKGRiID0+XG5cdFx0XHRkYi50cmFuc2FjdGlvbih0cmFuc2FjdGlvbk5hbWVTdHJpbmcpXG5cdFx0XHRcdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWVTdHJpbmcpXG5cdFx0XHRcdC5nZXRBbGwoKVxuXHRcdCkudGhlbihyZXNwb25zZU9iZWpjdHMgPT4ge1xuXHRcdFx0aWYgKHJlc3BvbnNlT2JlamN0cy5sZW5ndGggPD0gMCkge1xuXHRcdFx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRnJvbVNlcnZlcihcblx0XHRcdFx0XHRkYlByb21pc2UsXG5cdFx0XHRcdFx0b2JqZWN0U3RvcmVOYW1lU3RyaW5nLFxuXHRcdFx0XHRcdGRiUGVybWlzc2lvbixcblx0XHRcdFx0XHRjYWxsYmFja1xuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzcG9uc2VPYmVqY3RzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8vIEhhbmRsZSBmb3IgbGFzdCBlbnRyeSBvbiBSZXN0YXVyYW50cyBMaXN0XG5cdHN0YXRpYyBhZGRNaXNzaW5nRGF0YShyZXN0SnNvbikge1xuXHRcdGlmICghaXNOYU4ocmVzdEpzb24ucGhvdG9ncmFwaCkpIHtcblx0XHRcdHJlc3RKc29uLnBob3RvZ3JhcGggPSByZXN0SnNvbi5waG90b2dyYXBoICsgJy5qcGcnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN0SnNvblsncGhvdG9ncmFwaCddID0gcmVzdEpzb24uaWQgKyAnLmpwZyc7XG5cdFx0fVxuXHRcdHJldHVybiByZXN0SnNvbjtcblx0fVxufVxuIiwiLy8gQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG5jbGFzcyBEQkhlbHBlciB7XG5cdHN0YXRpYyBnZXQgTkVXX1VSTCgpIHtcblx0XHRyZXR1cm4gJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cyc7XG5cdH1cblx0LyoqXG4gICAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xuXHRcdFx0XHRpZiAocmVzdGF1cmFudCkge1xuXHRcdFx0XHRcdC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuXHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG5cdFx0XHRcdFx0Y2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcblx0XHRjdWlzaW5lLFxuXHRcdG5laWdoYm9yaG9vZCxcblx0XHRjYWxsYmFja1xuXHQpIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcblx0XHRcdFx0aWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHtcblx0XHRcdFx0XHQvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuXHRcdFx0XHRcdHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHtcblx0XHRcdFx0XHQvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKFxuXHRcdFx0XHRcdCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2Rcblx0XHRcdFx0KTtcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG5cdFx0XHRcdGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcihcblx0XHRcdFx0XHQodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGlcblx0XHRcdFx0KTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcblx0XHRcdFx0Y29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XG5cdFx0XHRcdC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcblx0XHRcdFx0Y29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoXG5cdFx0XHRcdFx0KHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgICAqL1xuXHRzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0cmV0dXJuIGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YDtcblx0fVxuXG5cdC8qKlxuICAgICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgICAqL1xuXHRzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcblx0XHRyZXR1cm4gYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YDtcblx0fVxuXG5cdC8qKlxuICAgICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICAgKi9cblx0c3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG5cdFx0Y29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFxuXHRcdFx0W3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSxcblx0XHRcdHtcblx0XHRcdFx0dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdFx0YWx0OiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHRcdHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxuXHRcdFx0fVxuXHRcdCk7XG5cdFx0bWFya2VyLmFkZFRvKG5ld01hcCk7XG5cdFx0cmV0dXJuIG1hcmtlcjtcblx0fVxufVxuIl0sImZpbGUiOiJhcHAtbWluLmpzIn0=

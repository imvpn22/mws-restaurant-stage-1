navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){console.log("Worker registered!")}).catch(function(t){console.log(t)}),function(){function t(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function e(e,n,r){var o,a=new Promise(function(a,s){t(o=e[n].apply(e,r)).then(a,s)});return a.request=o,a}function n(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function r(t,n,r,o){o.forEach(function(o){o in r.prototype&&(t.prototype[o]=function(){return e(this[n],o,arguments)})})}function o(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function a(t,n,r,o){o.forEach(function(o){o in r.prototype&&(t.prototype[o]=function(){return t=this[n],(r=e(t,o,arguments)).then(function(t){if(t)return new i(t,r.request)});var t,r})})}function s(t){this._index=t}function i(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function c(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new c(n)}function p(t){this._db=t}n(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(i,"_cursor",["direction","key","primaryKey","value"]),r(i,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(i.prototype[e]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,r),t(n._request).then(function(t){if(t)return new i(t,n._request)})})})}),u.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},n(u,"_store",["name","keyPath","indexNames","autoIncrement"]),r(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},n(c,"_tx",["objectStoreNames","mode"]),o(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),o(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[u,s].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,n=(e=arguments,Array.prototype.slice.call(e)),r=n[n.length-1],o=this._store||this._index,a=o[t].apply(o,n.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[s,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(o){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():o(r)):o(r)})})})});var h={open:function(t,n,r){var o=e(indexedDB,"open",[t,n]),a=o.request;return a&&(a.onupgradeneeded=function(t){r&&r(new l(a.result,t.oldVersion,a.transaction))}),o.then(function(t){return new p(t)})},delete:function(t){return e(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof module?(module.exports=h,module.exports.default=module.exports):self.idb=h}();var API_URL="http://localhost:1337/restaurants",fetchStatus=0;class IDbOperationsHelper{static checkForIDbSupport(){return"indexedDB"in window?1:0}static openIDb(t,e,n){return idb.open(t,e,t=>{t.createObjectStore(n,{autoIncrement:!0})})}static addToDb(t,e,n,r){t.then(t=>{var o=t.transaction(e,n);return o.objectStore(e).put(r),o.complete}).then(t=>{console.log("Restaurant saved to IDb")})}static getAllData(t,e,n){t.then(t=>t.transaction(e).objectStore(n).getAll()).then(t=>{IDbOperationsHelper.setRestaurantsData(t)})}static getRestaurantsFromServer(t,e,n,r){fetch(API_URL).then(t=>t.json()).then(o=>{o.forEach(t=>{t=IDbOperationsHelper.addMissingData(t)}),1!=fetchStatus&&(fetchStatus=1,o.forEach(r=>{IDbOperationsHelper.addToDb(t,e,n,r)})),console.log(o),r(null,o)}).catch(t=>{console.log(`Unable to fetch restaurants, Error: ${t}`),r(t,null)})}static getRestaurantsData(t){var e=IDbOperationsHelper.openIDb("restaurants-data",1,"restaurants");e.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(n=>{n.length<=0?IDbOperationsHelper.getRestaurantsFromServer(e,"restaurants","readwrite",t):t(null,n)})}static addMissingData(t){return isNaN(t.photograph)?t.photograph=t.id+".jpg":t.photograph=t.photograph+".jpg",t}}class DBHelper{static get NEW_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurantById(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.find(e=>e.id==t);n?e(null,n):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.cuisine_type==t);e(null,n)}})}static fetchRestaurantByNeighborhood(t,e){IDbOperationsHelper.getRestaurantsData((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.neighborhood==t);e(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,n){IDbOperationsHelper.getRestaurantsData((r,o)=>{if(r)n(r,null);else{let r=o;"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),n(null,r)}})}static fetchNeighborhoods(t){IDbOperationsHelper.getRestaurantsData((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].neighborhood),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static fetchCuisines(t){IDbOperationsHelper.getRestaurantsData((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].cuisine_type),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}`}static mapMarkerForRestaurant(t,e){const n=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return n.addTo(newMap),n}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Q29udHJvbGxlci5qcyIsImlkYi5qcyIsIklEYk9wZXJhdGlvbnNIZWxwZXIuanMiLCJkYmhlbHBlci5qcyJdLCJuYW1lcyI6WyJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJBUElfVVJMIiwiZmV0Y2hTdGF0dXMiLCJJRGJPcGVyYXRpb25zSGVscGVyIiwiW29iamVjdCBPYmplY3RdIiwid2luZG93Iiwib2JqZWN0U3RvcmVOYW1lIiwidXBncmFkZURCIiwiYXV0b0luY3JlbWVudCIsImRiUHJvbWlzZSIsInBlcm1pc2lvbiIsImpzb25EYXRhIiwidHJhbnNhY3QiLCJwdXQiLCJyZXNwb25zZSIsInRyYW5zYWN0aW9uTmFtZSIsImFycnkiLCJzZXRSZXN0YXVyYW50c0RhdGEiLCJmZXRjaCIsImpzb24iLCJyZXNwb25zZUpzb24iLCJyZXN0YXVyYW50IiwiYWRkTWlzc2luZ0RhdGEiLCJyZXN0YXVyYW50RGF0YSIsImFkZFRvRGIiLCJvcGVuSURiIiwicmVzcG9uc2VPYmVqY3RzIiwiZ2V0UmVzdGF1cmFudHNGcm9tU2VydmVyIiwicmVzdEpzb24iLCJpc05hTiIsInBob3RvZ3JhcGgiLCJpZCIsIkRCSGVscGVyIiwiTkVXX1VSTCIsImdldFJlc3RhdXJhbnRzRGF0YSIsInJlc3RhdXJhbnRzIiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsIm1hcmtlciIsIkwiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsImFsdCIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhZGRUbyIsIm5ld01hcCJdLCJtYXBwaW5ncyI6IkFBQUlBLFVBQVVDLGVBQ2JELFVBQVVDLGNBQWNDLFNBQVMsVUFBVUMsS0FBSyxXQUMvQ0MsUUFBUUMsSUFBSSx3QkFDVkMsTUFBTSxTQUFTQyxHQUNqQkgsUUFBUUMsSUFBSUUsS0FNYixXQUtBLFNBQVNDLEVBQWlCQyxHQUN6QixPQUFPLElBQUlDLFFBQVEsU0FBU0MsRUFBU0MsR0FDcENILEVBQVFJLFVBQVksV0FDbkJGLEVBQVFGLEVBQVFLLFNBR2pCTCxFQUFRTSxRQUFVLFdBQ2pCSCxFQUFPSCxFQUFRTyxVQUtsQixTQUFTQyxFQUFxQkMsRUFBS0MsRUFBUUMsR0FDMUMsSUFBSVgsRUFDQVksRUFBSSxJQUFJWCxRQUFRLFNBQVNDLEVBQVNDLEdBRXJDSixFQURBQyxFQUFVUyxFQUFJQyxHQUFRRyxNQUFNSixFQUFLRSxJQUNQakIsS0FBS1EsRUFBU0MsS0FJekMsT0FEQVMsRUFBRVosUUFBVUEsRUFDTFksRUFXUixTQUFTRSxFQUFnQkMsRUFBWUMsRUFBWUMsR0FDaERBLEVBQVdDLFFBQVEsU0FBU0MsR0FDM0JDLE9BQU9DLGVBQWVOLEVBQVdPLFVBQVdILEVBQU0sQ0FDakRJLElBQUssV0FDSixPQUFPQyxLQUFLUixHQUFZRyxJQUV6Qk0sSUFBSyxTQUFTQyxHQUNiRixLQUFLUixHQUFZRyxHQUFRTyxPQU03QixTQUFTQyxFQUFvQlosRUFBWUMsRUFBWVksRUFBYVgsR0FDakVBLEVBQVdDLFFBQVEsU0FBU0MsR0FDckJBLEtBQVFTLEVBQVlOLFlBQzFCUCxFQUFXTyxVQUFVSCxHQUFRLFdBQzVCLE9BQU9YLEVBQXFCZ0IsS0FBS1IsR0FBYUcsRUFBTVUsZUFLdkQsU0FBU0MsRUFBYWYsRUFBWUMsRUFBWVks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LElBQ2pDLENBQUNDLEVBQUdDLElBQU1YLEVBQVlXLEdBQUdKLGNBR3BCSyxFQUFzQkosRUFBY0gsT0FDekMsQ0FBQ0ssRUFBR0MsSUFBTUgsRUFBY0ssUUFBUUgsSUFBTUMsR0FFdkN2RSxFQUFTLEtBQU13RSxNQVFsQjNDLHFCQUFxQjdCLEdBRXBCNEIsb0JBQW9CK0IsbUJBQW1CLENBQUMxSCxFQUFPMkgsS0FDOUMsR0FBSTNILEVBQ0grRCxFQUFTL0QsRUFBTyxVQUNWLENBRU4sTUFBTXlJLEVBQVdkLEVBQVlTLElBQUksQ0FBQ0MsRUFBR0MsSUFBTVgsRUFBWVcsR0FBR0wsY0FFcERTLEVBQWlCRCxFQUFTVCxPQUMvQixDQUFDSyxFQUFHQyxJQUFNRyxFQUFTRCxRQUFRSCxJQUFNQyxHQUVsQ3ZFLEVBQVMsS0FBTTJFLE1BUWxCOUMsd0JBQXdCaUIsR0FDdkIsOEJBQStCQSxFQUFXVSxLQU0zQzNCLDZCQUE2QmlCLEdBQzVCLGNBQWVBLEVBQVdTLGFBTTNCMUIsOEJBQThCaUIsRUFBWXVCLEdBQ3pDLE1BQU1PLEVBQVMsSUFBSUMsRUFBRUQsT0FDcEIsQ0FBQzlCLEVBQVdnQyxPQUFPQyxJQUFLakMsRUFBV2dDLE9BQU9FLEtBQzFDLENBQ0NDLE1BQU9uQyxFQUFXaEMsS0FDbEJvRSxJQUFLcEMsRUFBV2hDLEtBQ2hCcUUsSUFBSzFCLFNBQVMyQixpQkFBaUJ0QyxLQUlqQyxPQURBOEIsRUFBT1MsTUFBTUMsUUFDTlYiLCJzb3VyY2VzQ29udGVudCI6WyJpZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcblx0bmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24oKSB7XG5cdFx0Y29uc29sZS5sb2coJ1dvcmtlciByZWdpc3RlcmVkIScpO1xuXHR9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcblx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHR9KTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuXHRmdW5jdGlvbiB0b0FycmF5KGFycikge1xuXHRcdHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0cmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG5cdFx0XHR9O1xuXG5cdFx0XHRyZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG5cdFx0dmFyIHJlcXVlc3Q7XG5cdFx0dmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuXHRcdFx0cHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG5cdFx0fSk7XG5cblx0XHRwLnJlcXVlc3QgPSByZXF1ZXN0O1xuXHRcdHJldHVybiBwO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcblx0XHR2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcblx0XHRyZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRpZiAoIXZhbHVlKSByZXR1cm47XG5cdFx0XHRyZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuXHRcdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuXHRcdFx0XHRcdHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuXHRcdHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG5cdFx0XHRpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblx0XHRcdFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuXHRcdHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG5cdFx0XHRpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblx0XHRcdFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuXHRcdHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG5cdFx0XHRpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblx0XHRcdFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG5cdFx0dGhpcy5faW5kZXggPSBpbmRleDtcblx0fVxuXG5cdHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcblx0XHQnbmFtZScsXG5cdFx0J2tleVBhdGgnLFxuXHRcdCdtdWx0aUVudHJ5Jyxcblx0XHQndW5pcXVlJ1xuXHRdKTtcblxuXHRwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcblx0XHQnZ2V0Jyxcblx0XHQnZ2V0S2V5Jyxcblx0XHQnZ2V0QWxsJyxcblx0XHQnZ2V0QWxsS2V5cycsXG5cdFx0J2NvdW50J1xuXHRdKTtcblxuXHRwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcblx0XHQnb3BlbkN1cnNvcicsXG5cdFx0J29wZW5LZXlDdXJzb3InXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcblx0XHR0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG5cdFx0dGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG5cdH1cblxuXHRwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcblx0XHQnZGlyZWN0aW9uJyxcblx0XHQna2V5Jyxcblx0XHQncHJpbWFyeUtleScsXG5cdFx0J3ZhbHVlJ1xuXHRdKTtcblxuXHRwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcblx0XHQndXBkYXRlJyxcblx0XHQnZGVsZXRlJ1xuXHRdKTtcblxuXHQvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuXHRbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG5cdFx0aWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBjdXJzb3IgPSB0aGlzO1xuXHRcdFx0dmFyIGFyZ3MgPSBhcmd1bWVudHM7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcblx0XHRcdFx0Y3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuXHRcdFx0XHRyZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdFx0XHRpZiAoIXZhbHVlKSByZXR1cm47XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fTtcblx0fSk7XG5cblx0ZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcblx0XHR0aGlzLl9zdG9yZSA9IHN0b3JlO1xuXHR9XG5cblx0T2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0T2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuXHRcdCduYW1lJyxcblx0XHQna2V5UGF0aCcsXG5cdFx0J2luZGV4TmFtZXMnLFxuXHRcdCdhdXRvSW5jcmVtZW50J1xuXHRdKTtcblxuXHRwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcblx0XHQncHV0Jyxcblx0XHQnYWRkJyxcblx0XHQnZGVsZXRlJyxcblx0XHQnY2xlYXInLFxuXHRcdCdnZXQnLFxuXHRcdCdnZXRBbGwnLFxuXHRcdCdnZXRLZXknLFxuXHRcdCdnZXRBbGxLZXlzJyxcblx0XHQnY291bnQnXG5cdF0pO1xuXG5cdHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuXHRcdCdvcGVuQ3Vyc29yJyxcblx0XHQnb3BlbktleUN1cnNvcidcblx0XSk7XG5cblx0cHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcblx0XHQnZGVsZXRlSW5kZXgnXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG5cdFx0dGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcblx0XHR0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdH07XG5cdFx0XHRpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG5cdFx0XHR9O1xuXHRcdFx0aWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fVxuXG5cdFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuXHR9O1xuXG5cdHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcblx0XHQnb2JqZWN0U3RvcmVOYW1lcycsXG5cdFx0J21vZGUnXG5cdF0pO1xuXG5cdHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG5cdFx0J2Fib3J0J1xuXHRdKTtcblxuXHRmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG5cdFx0dGhpcy5fZGIgPSBkYjtcblx0XHR0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuXHRcdHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuXHR9XG5cblx0VXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuXHR9O1xuXG5cdHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG5cdFx0J25hbWUnLFxuXHRcdCd2ZXJzaW9uJyxcblx0XHQnb2JqZWN0U3RvcmVOYW1lcydcblx0XSk7XG5cblx0cHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG5cdFx0J2RlbGV0ZU9iamVjdFN0b3JlJyxcblx0XHQnY2xvc2UnXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIERCKGRiKSB7XG5cdFx0dGhpcy5fZGIgPSBkYjtcblx0fVxuXG5cdERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuXHR9O1xuXG5cdHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcblx0XHQnbmFtZScsXG5cdFx0J3ZlcnNpb24nLFxuXHRcdCdvYmplY3RTdG9yZU5hbWVzJ1xuXHRdKTtcblxuXHRwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuXHRcdCdjbG9zZSdcblx0XSk7XG5cblx0Ly8gQWRkIGN1cnNvciBpdGVyYXRvcnNcblx0Ly8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuXHRbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcblx0XHRbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG5cdFx0XHQvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG5cdFx0XHRpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cblx0XHRcdENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG5cdFx0XHRcdHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcblx0XHRcdFx0dmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuXHRcdFx0XHR2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG5cdFx0XHRcdHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fTtcblx0XHR9KTtcblx0fSk7XG5cblx0Ly8gcG9seWZpbGwgZ2V0QWxsXG5cdFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcblx0XHRpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuXHRcdENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcblx0XHRcdHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cdFx0XHR2YXIgaXRlbXMgPSBbXTtcblxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdFx0aW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG5cdFx0XHRcdFx0aWYgKCFjdXJzb3IpIHtcblx0XHRcdFx0XHRcdHJlc29sdmUoaXRlbXMpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cblx0XHRcdFx0XHRpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcblx0XHRcdFx0XHRcdHJlc29sdmUoaXRlbXMpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRjdXJzb3IuY29udGludWUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KTtcblxuXHR2YXIgZXhwID0ge1xuXHRcdG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuXHRcdFx0dmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcblx0XHRcdHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG5cdFx0XHRpZiAocmVxdWVzdCkge1xuXHRcdFx0XHRyZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHRcdFx0aWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuXHRcdFx0XHRcdFx0dXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcblx0XHRcdFx0cmV0dXJuIG5ldyBEQihkYik7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0cmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcblx0XHR9XG5cdH07XG5cblx0aWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBleHA7XG5cdFx0bW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdGVsc2Uge1xuXHRcdHNlbGYuaWRiID0gZXhwO1xuXHR9XG59KCkpO1xuIiwidmFyIEFQSV9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzJztcbnZhciBmZXRjaFN0YXR1cyA9IDA7XG5cbi8vIEhlbHBlciBGdW5jdGlvbnMgZm9yIHZhcmlvdXMgSURiIE9wZXJhdGlvbnNcbmNsYXNzIElEYk9wZXJhdGlvbnNIZWxwZXIge1xuXHRzdGF0aWMgY2hlY2tGb3JJRGJTdXBwb3J0KCkge1xuXHRcdGlmICghKCdpbmRleGVkREInIGluIHdpbmRvdykpIHtcblx0XHRcdHJldHVybiAwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gMTtcblx0XHR9XG5cdH1cblxuXHRzdGF0aWMgb3BlbklEYihuYW1lLCB2ZXJzaW9uLCBvYmplY3RTdG9yZU5hbWUpIHtcblx0XHR2YXIgZGJQcm9taXNlID0gaWRiLm9wZW4obmFtZSwgdmVyc2lvbiwgdXBncmFkZURCID0+IHtcblx0XHRcdHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUsIHsgYXV0b0luY3JlbWVudDogdHJ1ZSB9KTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZGJQcm9taXNlO1xuXHR9XG5cblx0c3RhdGljIGFkZFRvRGIoZGJQcm9taXNlLCBvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbiwganNvbkRhdGEpIHtcblx0XHRkYlByb21pc2UudGhlbihkYiA9PiB7XG5cdFx0XHR2YXIgdHJhbnNhY3QgPSBkYi50cmFuc2FjdGlvbihvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbik7XG5cdFx0XHQvL0FkZCBhbGwgdGhlIGpzb24gY29udGVudCBoZXJlXG5cdFx0XHR0cmFuc2FjdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUpLnB1dChqc29uRGF0YSk7XG5cdFx0XHRyZXR1cm4gdHJhbnNhY3QuY29tcGxldGU7XG5cdFx0fSkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnUmVzdGF1cmFudCBzYXZlZCB0byBJRGInKTtcblx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRBbGxEYXRhKGRiUHJvbWlzZSwgdHJhbnNhY3Rpb25OYW1lLCBvYmplY3RTdG9yZU5hbWUpIHtcblx0XHR2YXIgcmVzcG9uc2VBcnJheVByb21pc2UgPSBkYlByb21pc2UudGhlbihkYiA9PiBkYlxuXHRcdFx0LnRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uTmFtZSlcblx0XHRcdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWUpXG5cdFx0XHQuZ2V0QWxsKClcblx0XHQpO1xuXHRcdHJlc3BvbnNlQXJyYXlQcm9taXNlLnRoZW4oYXJyeSA9PiB7XG5cdFx0XHRJRGJPcGVyYXRpb25zSGVscGVyLnNldFJlc3RhdXJhbnRzRGF0YShhcnJ5KTtcblx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50c0Zyb21TZXJ2ZXIoZGJQcm9taXNlLCBvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbiwgY2FsbGJhY2spIHtcblx0XHRmZXRjaChBUElfVVJMKVxuXHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuXHRcdFx0LnRoZW4ocmVzcG9uc2VKc29uID0+IHtcblx0XHRcdFx0cmVzcG9uc2VKc29uLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG5cdFx0XHRcdFx0cmVzdGF1cmFudCA9IElEYk9wZXJhdGlvbnNIZWxwZXIuYWRkTWlzc2luZ0RhdGEocmVzdGF1cmFudCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChmZXRjaFN0YXR1cyAhPSAxKSB7XG5cdFx0XHRcdFx0ZmV0Y2hTdGF0dXMgPSAxO1xuXHRcdFx0XHRcdHJlc3BvbnNlSnNvbi5mb3JFYWNoKHJlc3RhdXJhbnREYXRhID0+IHtcblxuXHRcdFx0XHRcdFx0Ly9BZGQgZXZlcnkgc2luZ2xlIHJlc3RhdXJhbnQgZGF0YSB0byBJRGJcblx0XHRcdFx0XHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuYWRkVG9EYihcblx0XHRcdFx0XHRcdFx0ZGJQcm9taXNlLFxuXHRcdFx0XHRcdFx0XHRvYmplY3RTdG9yZU5hbWUsXG5cdFx0XHRcdFx0XHRcdHBlcm1pc2lvbixcblx0XHRcdFx0XHRcdFx0cmVzdGF1cmFudERhdGFcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb25zb2xlLmxvZyhyZXNwb25zZUpzb24pO1xuXHRcdFx0XHRjYWxsYmFjayAobnVsbCwgcmVzcG9uc2VKc29uKTtcblx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0Y29uc29sZS5sb2coYFVuYWJsZSB0byBmZXRjaCByZXN0YXVyYW50cywgRXJyb3I6ICR7ZXJyb3J9YCk7XG5cdFx0XHRcdGNhbGxiYWNrIChlcnJvciwgbnVsbCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50c0RhdGEoY2FsbGJhY2spIHtcblx0XHR2YXIgaWRiTmFtZSA9ICdyZXN0YXVyYW50cy1kYXRhJztcblx0XHR2YXIgZGJWZXJzaW9uID0gMTtcblx0XHR2YXIgb2JqZWN0U3RvcmVOYW1lU3RyaW5nID0gJ3Jlc3RhdXJhbnRzJztcblx0XHR2YXIgdHJhbnNhY3Rpb25OYW1lU3RyaW5nID0gJ3Jlc3RhdXJhbnRzJztcblx0XHR2YXIgZGJQZXJtaXNzaW9uID0gJ3JlYWR3cml0ZSc7XG5cblx0XHR2YXIgZGJQcm9taXNlID0gSURiT3BlcmF0aW9uc0hlbHBlci5vcGVuSURiKFxuXHRcdFx0aWRiTmFtZSxcblx0XHRcdGRiVmVyc2lvbixcblx0XHRcdG9iamVjdFN0b3JlTmFtZVN0cmluZ1xuXHRcdCk7XG5cblx0XHRkYlByb21pc2UudGhlbihkYiA9PlxuXHRcdFx0ZGIudHJhbnNhY3Rpb24odHJhbnNhY3Rpb25OYW1lU3RyaW5nKVxuXHRcdFx0XHQub2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lU3RyaW5nKVxuXHRcdFx0XHQuZ2V0QWxsKClcblx0XHQpLnRoZW4ocmVzcG9uc2VPYmVqY3RzID0+IHtcblx0XHRcdGlmIChyZXNwb25zZU9iZWpjdHMubGVuZ3RoIDw9IDApIHtcblx0XHRcdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0Zyb21TZXJ2ZXIoXG5cdFx0XHRcdFx0ZGJQcm9taXNlLFxuXHRcdFx0XHRcdG9iamVjdFN0b3JlTmFtZVN0cmluZyxcblx0XHRcdFx0XHRkYlBlcm1pc3Npb24sXG5cdFx0XHRcdFx0Y2FsbGJhY2tcblx0XHRcdFx0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlT2JlamN0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvLyBIYW5kbGUgZm9yIGxhc3QgZW50cnkgb24gUmVzdGF1cmFudHMgTGlzdFxuXHRzdGF0aWMgYWRkTWlzc2luZ0RhdGEocmVzdEpzb24pIHtcblx0XHRpZiAoIWlzTmFOKHJlc3RKc29uLnBob3RvZ3JhcGgpKSB7XG5cdFx0XHRyZXN0SnNvbi5waG90b2dyYXBoID0gcmVzdEpzb24ucGhvdG9ncmFwaCArICcuanBnJztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVzdEpzb25bJ3Bob3RvZ3JhcGgnXSA9IHJlc3RKc29uLmlkICsgJy5qcGcnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVzdEpzb247XG5cdH1cbn1cbiIsIi8vIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuY2xhc3MgREJIZWxwZXIge1xuXHRzdGF0aWMgZ2V0IE5FV19VUkwoKSB7XG5cdFx0cmV0dXJuICdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMnO1xuXHR9XG5cdC8qKlxuICAgICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuXHRcdC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcblx0XHRcdFx0aWYgKHJlc3RhdXJhbnQpIHtcblx0XHRcdFx0XHQvLyBHb3QgdGhlIHJlc3RhdXJhbnRcblx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxuXHRcdFx0XHRcdGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoXG5cdFx0Y3Vpc2luZSxcblx0XHRuZWlnaGJvcmhvb2QsXG5cdFx0Y2FsbGJhY2tcblx0KSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XG5cdFx0XHRcdGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XG5cdFx0XHRcdFx0Ly8gZmlsdGVyIGJ5IGN1aXNpbmVcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7XG5cdFx0XHRcdFx0Ly8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuXHRcdFx0XHRcdHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcblx0XHRcdFx0Y29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChcblx0XHRcdFx0XHQodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kXG5cdFx0XHRcdCk7XG5cdFx0XHRcdC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuXHRcdFx0XHRjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoXG5cdFx0XHRcdFx0KHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpXG5cdFx0XHRcdCk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHRcdGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG5cdFx0XHRcdGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKFxuXHRcdFx0XHRcdCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGlcblx0XHRcdFx0KTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cbiAgICAgKi9cblx0c3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuXHRcdHJldHVybiBgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWA7XG5cdH1cblxuXHQvKipcbiAgICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICAgKi9cblx0c3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0cmV0dXJuIGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWA7XG5cdH1cblxuXHQvKipcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAgICovXG5cdHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuXHRcdGNvbnN0IG1hcmtlciA9IG5ldyBMLm1hcmtlcihcblx0XHRcdFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG5cdFx0XHR7XG5cdFx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHRcdGFsdDogcmVzdGF1cmFudC5uYW1lLFxuXHRcdFx0XHR1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudClcblx0XHRcdH1cblx0XHQpO1xuXHRcdG1hcmtlci5hZGRUbyhuZXdNYXApO1xuXHRcdHJldHVybiBtYXJrZXI7XG5cdH1cbn1cbiJdLCJmaWxlIjoiYXBwLW1pbi5qcyJ9

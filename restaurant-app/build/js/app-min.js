navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(t=>{console.log("*** Service Worker registered ***")}).catch(function(t){console.log(t)}),function(){function t(t){return new Promise(function(e,r){t.onsuccess=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function e(e,r,n){var o,a=new Promise(function(a,s){t(o=e[r].apply(e,n)).then(a,s)});return a.request=o,a}function r(t,e,r){r.forEach(function(r){Object.defineProperty(t.prototype,r,{get:function(){return this[e][r]},set:function(t){this[e][r]=t}})})}function n(t,r,n,o){o.forEach(function(o){o in n.prototype&&(t.prototype[o]=function(){return e(this[r],o,arguments)})})}function o(t,e,r,n){n.forEach(function(n){n in r.prototype&&(t.prototype[n]=function(){return this[e][n].apply(this[e],arguments)})})}function a(t,r,n,o){o.forEach(function(o){o in n.prototype&&(t.prototype[o]=function(){return t=this[r],(n=e(t,o,arguments)).then(function(t){if(t)return new i(t,n.request)});var t,n})})}function s(t){this._index=t}function i(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function c(t){this._tx=t,this.complete=new Promise(function(e,r){t.oncomplete=function(){e()},t.onerror=function(){r(t.error)},t.onabort=function(){r(t.error)}})}function l(t,e,r){this._db=t,this.oldVersion=e,this.transaction=new c(r)}function p(t){this._db=t}r(s,"_index",["name","keyPath","multiEntry","unique"]),n(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(i,"_cursor",["direction","key","primaryKey","value"]),n(i,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(i.prototype[e]=function(){var r=this,n=arguments;return Promise.resolve().then(function(){return r._cursor[e].apply(r._cursor,n),t(r._request).then(function(t){if(t)return new i(t,r._request)})})})}),u.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},r(u,"_store",["name","keyPath","indexNames","autoIncrement"]),n(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},r(c,"_tx",["objectStoreNames","mode"]),o(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},r(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},r(p,"_db",["name","version","objectStoreNames"]),o(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[u,s].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,r=(e=arguments,Array.prototype.slice.call(e)),n=r[r.length-1],o=this._store||this._index,a=o[t].apply(o,r.slice(0,-1));a.onsuccess=function(){n(a.result)}})})}),[s,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var r=this,n=[];return new Promise(function(o){r.iterateCursor(t,function(t){t?(n.push(t.value),void 0===e||n.length!=e?t.continue():o(n)):o(n)})})})});var h={open:function(t,r,n){var o=e(indexedDB,"open",[t,r]),a=o.request;return a&&(a.onupgradeneeded=function(t){n&&n(new l(a.result,t.oldVersion,a.transaction))}),o.then(function(t){return new p(t)})},delete:function(t){return e(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof module?(module.exports=h,module.exports.default=module.exports):self.idb=h}();var API_URL="http://localhost:1337/restaurants",fetchStatus=0,reviewsFetchStatus=0;class IDbOperationsHelper{static checkForIDbSupport(){return"indexedDB"in window?1:0}static openIDb(t,e,r){return idb.open(t,e,t=>{t.createObjectStore(r,{autoIncrement:!0})})}static addToDb(t,e,r,n){t.then(t=>{var o=t.transaction(e,r);return o.objectStore(e).put(n),o.complete}).then(t=>{console.log("Restaurant saved to IDB")})}static getAllData(t,e,r){t.then(t=>t.transaction(e).objectStore(r).getAll()).then(t=>{IDbOperationsHelper.setRestaurantsData(t)})}static getDataFromServer(t,e,r,n){fetch(API_URL).then(t=>t.json()).then(o=>{o.forEach(t=>{t=IDbOperationsHelper.addMissingData(t)}),1!=fetchStatus&&(fetchStatus=1,o.forEach(n=>{IDbOperationsHelper.addToDb(t,e,r,n)})),n(null,o)}).catch(t=>{n(t,null)})}static getRestaurantsData(t){var e=IDbOperationsHelper.openIDb("restaurants-data",1,"restaurants");e.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(r=>{r.length<=0?IDbOperationsHelper.getDataFromServer(e,"restaurants","readwrite",t):t(null,r)})}static updateRestaurantData(t){IDbOperationsHelper.openIDb("restaurants-data",1,"restaurants").then(e=>e.transaction("restaurants","readwrite").objectStore("restaurants").put(t)).then(t=>{console.log("test success"),console.log(t)}).catch(t=>{console.log("test failed"),console.log(t)})}static addMissingData(t){return isNaN(t.photograph)?t.photograph=t.id+".jpg":t.photograph=t.photograph+".jpg",t}static getReviewsFromServer(t,e,r,n){fetch("http://localhost:1337/reviews/").then(t=>t.json()).then(o=>{1!=reviewsFetchStatus&&(reviewsFetchStatus=1,o.forEach(n=>{IDbOperationsHelper.addToDb(t,e,r,n)})),n(null,o)}).catch(t=>{n(t,null)})}static getReviewsData(t){var e=IDbOperationsHelper.openIDb("restaurants-data",1,"reviews");e.then(t=>t.transaction("reviews").objectStore("reviews").getAll()).then(r=>{r.length<=0?IDbOperationsHelper.getReviewsFromServer(e,"reviews","readwrite",t):t(null,r)})}}class DBHelper{static get NEW_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurantById(t,e){IDbOperationsHelper.getRestaurantsData((r,n)=>{if(r)e(r,null);else{const r=n.find(e=>e.id==t);r?e(null,r):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){IDbOperationsHelper.getRestaurantsData((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){IDbOperationsHelper.getRestaurantsData((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){IDbOperationsHelper.getRestaurantsData((n,o)=>{if(n)r(n,null);else{let n=o;"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),r(null,n)}})}static fetchNeighborhoods(t){IDbOperationsHelper.getRestaurantsData((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static fetchCuisines(t){IDbOperationsHelper.getRestaurantsData((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}`}static mapMarkerForRestaurant(t,e){const r=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return r.addTo(newMap),r}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Q29udHJvbGxlci5qcyIsImlkYi5qcyIsIklEYk9wZXJhdGlvbnNIZWxwZXIuanMiLCJkYmhlbHBlci5qcyJdLCJuYW1lcyI6WyJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJ0aGVuIiwicmVnIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJBUElfVVJMIiwiZmV0Y2hTdGF0dXMiLCJyZXZpZXdzRmV0Y2hTdGF0dXMiLCJJRGJPcGVyYXRpb25zSGVscGVyIiwiW29iamVjdCBPYmplY3RdIiwid2luZG93Iiwib2JqZWN0U3RvcmVOYW1lIiwidXBncmFkZURCIiwiYXV0b0luY3JlbWVudCIsImRiUHJvbWlzZSIsInBlcm1pc2lvbiIsImpzb25EYXRhIiwidHJhbnNhY3QiLCJwdXQiLCJyZXNwb25zZSIsInRyYW5zYWN0aW9uTmFtZSIsImFycnkiLCJzZXRSZXN0YXVyYW50c0RhdGEiLCJmZXRjaCIsImpzb24iLCJyZXNwb25zZUpzb24iLCJyZXN0YXVyYW50IiwiYWRkTWlzc2luZ0RhdGEiLCJyZXN0YXVyYW50RGF0YSIsImFkZFRvRGIiLCJvcGVuSURiIiwicmVzcG9uc2VPYmVqY3RzIiwiZ2V0RGF0YUZyb21TZXJ2ZXIiLCJyZXMiLCJyZXN0SnNvbiIsImlzTmFOIiwicGhvdG9ncmFwaCIsImlkIiwiZ2V0UmV2aWV3c0Zyb21TZXJ2ZXIiLCJEQkhlbHBlciIsIk5FV19VUkwiLCJnZXRSZXN0YXVyYW50c0RhdGEiLCJyZXN0YXVyYW50cyIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJhbHQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJuZXdNYXAiXSwibWFwcGluZ3MiOiJBQUFJQSxVQUFVQyxlQUNiRCxVQUFVQyxjQUFjQyxTQUFTLFVBQVVDLEtBQUtDLElBQy9DQyxRQUFRQyxJQUFJLHVDQUNWQyxNQUFNLFNBQVNDLEdBQ2pCSCxRQUFRQyxJQUFJRSxLQU1iLFdBS0EsU0FBU0MsRUFBaUJDLEdBQ3pCLE9BQU8sSUFBSUMsUUFBUSxTQUFTQyxFQUFTQyxHQUNwQ0gsRUFBUUksVUFBWSxXQUNuQkYsRUFBUUYsRUFBUUssU0FHakJMLEVBQVFNLFFBQVUsV0FDakJILEVBQU9ILEVBQVFPLFVBS2xCLFNBQVNDLEVBQXFCQyxFQUFLQyxFQUFRQyxHQUMxQyxJQUFJWCxFQUNBWSxFQUFJLElBQUlYLFFBQVEsU0FBU0MsRUFBU0MsR0FFckNKLEVBREFDLEVBQVVTLEVBQUlDLEdBQVFHLE1BQU1KLEVBQUtFLElBQ1BsQixLQUFLUyxFQUFTQyxLQUl6QyxPQURBUyxFQUFFWixRQUFVQSxFQUNMWSxFQVdSLFNBQVNFLEVBQWdCQyxFQUFZQyxFQUFZQyxHQUNoREEsRUFBV0MsUUFBUSxTQUFTQyxHQUMzQkMsT0FBT0MsZUFBZU4sRUFBV08sVUFBV0gsRUFBTSxDQUNqREksSUFBSyxXQUNKLE9BQU9DLEtBQUtSLEdBQVlHLElBRXpCTSxJQUFLLFNBQVNDLEdBQ2JGLEtBQUtSLEdBQVlHLEdBQVFPLE9BTTdCLFNBQVNDLEVBQW9CWixFQUFZQyxFQUFZWSxFQUFhWCxHQUNqRUEsRUFBV0MsUUFBUSxTQUFTQyxHQUNyQkEsS0FBUVMsRUFBWU4sWUFDMUJQLEVBQVdPLFVBQVVILEdBQVEsV0FDNUIsT0FBT1gsRUFBcUJn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LENBRU4sTUFBTTRJLEVBQVdkLEVBQVlTLElBQUksQ0FBQ0MsRUFBR0MsSUFBTVgsRUFBWVcsR0FBR0wsY0FFcERTLEVBQWlCRCxFQUFTVCxPQUMvQixDQUFDSyxFQUFHQyxJQUFNRyxFQUFTRCxRQUFRSCxJQUFNQyxHQUVsQzFFLEVBQVMsS0FBTThFLE1BUWxCaEQsd0JBQXdCaUIsR0FDdkIsOEJBQStCQSxFQUFXVyxLQU0zQzVCLDZCQUE2QmlCLEdBQzVCLGNBQWVBLEVBQVdVLGFBTTNCM0IsOEJBQThCaUIsRUFBWXlCLEdBQ3pDLE1BQU1PLEVBQVMsSUFBSUMsRUFBRUQsT0FDcEIsQ0FBQ2hDLEVBQVdrQyxPQUFPQyxJQUFLbkMsRUFBV2tDLE9BQU9FLEtBQzFDLENBQ0NDLE1BQU9yQyxFQUFXakMsS0FDbEJ1RSxJQUFLdEMsRUFBV2pDLEtBQ2hCd0UsSUFBSzFCLFNBQVMyQixpQkFBaUJ4QyxLQUlqQyxPQURBZ0MsRUFBT1MsTUFBTUMsUUFDTlYiLCJzb3VyY2VzQ29udGVudCI6WyJpZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcblx0bmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4ocmVnID0+IHtcblx0XHRjb25zb2xlLmxvZygnKioqIFNlcnZpY2UgV29ya2VyIHJlZ2lzdGVyZWQgKioqJyk7XG5cdH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuXHRcdGNvbnNvbGUubG9nKGVycik7XG5cdH0pO1xufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG5cdGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG5cdFx0cmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRyZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcblx0XHRcdH07XG5cblx0XHRcdHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZWplY3QocmVxdWVzdC5lcnJvcik7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcblx0XHR2YXIgcmVxdWVzdDtcblx0XHR2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0cmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG5cdFx0XHRwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcblx0XHR9KTtcblxuXHRcdHAucmVxdWVzdCA9IHJlcXVlc3Q7XG5cdFx0cmV0dXJuIHA7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuXHRcdHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuXHRcdHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdGlmICghdmFsdWUpIHJldHVybjtcblx0XHRcdHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcblx0XHRwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG5cdFx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldDogZnVuY3Rpb24odmFsKSB7XG5cdFx0XHRcdFx0dGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdFx0UHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdFx0UHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcblx0XHRcdH07XG5cdFx0fSk7XG5cdH1cblxuXHRmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG5cdFx0cHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcblx0XHRcdGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXHRcdFx0UHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcblx0XHR0aGlzLl9pbmRleCA9IGluZGV4O1xuXHR9XG5cblx0cHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuXHRcdCduYW1lJyxcblx0XHQna2V5UGF0aCcsXG5cdFx0J211bHRpRW50cnknLFxuXHRcdCd1bmlxdWUnXG5cdF0pO1xuXG5cdHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuXHRcdCdnZXQnLFxuXHRcdCdnZXRLZXknLFxuXHRcdCdnZXRBbGwnLFxuXHRcdCdnZXRBbGxLZXlzJyxcblx0XHQnY291bnQnXG5cdF0pO1xuXG5cdHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuXHRcdCdvcGVuQ3Vyc29yJyxcblx0XHQnb3BlbktleUN1cnNvcidcblx0XSk7XG5cblx0ZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuXHRcdHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcblx0XHR0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcblx0fVxuXG5cdHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuXHRcdCdkaXJlY3Rpb24nLFxuXHRcdCdrZXknLFxuXHRcdCdwcmltYXJ5S2V5Jyxcblx0XHQndmFsdWUnXG5cdF0pO1xuXG5cdHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuXHRcdCd1cGRhdGUnLFxuXHRcdCdkZWxldGUnXG5cdF0pO1xuXG5cdC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG5cdFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcblx0XHRpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG5cdFx0Q3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGN1cnNvciA9IHRoaXM7XG5cdFx0XHR2YXIgYXJncyA9IGFyZ3VtZW50cztcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG5cdFx0XHRcdHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRcdGlmICghdmFsdWUpIHJldHVybjtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KTtcblxuXHRmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuXHRcdHRoaXMuX3N0b3JlID0gc3RvcmU7XG5cdH1cblxuXHRPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcblx0fTtcblxuXHRPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcblx0fTtcblxuXHRwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG5cdFx0J25hbWUnLFxuXHRcdCdrZXlQYXRoJyxcblx0XHQnaW5kZXhOYW1lcycsXG5cdFx0J2F1dG9JbmNyZW1lbnQnXG5cdF0pO1xuXG5cdHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuXHRcdCdwdXQnLFxuXHRcdCdhZGQnLFxuXHRcdCdkZWxldGUnLFxuXHRcdCdjbGVhcicsXG5cdFx0J2dldCcsXG5cdFx0J2dldEFsbCcsXG5cdFx0J2dldEtleScsXG5cdFx0J2dldEFsbEtleXMnLFxuXHRcdCdjb3VudCdcblx0XSk7XG5cblx0cHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG5cdFx0J29wZW5DdXJzb3InLFxuXHRcdCdvcGVuS2V5Q3Vyc29yJ1xuXHRdKTtcblxuXHRwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuXHRcdCdkZWxldGVJbmRleCdcblx0XSk7XG5cblx0ZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcblx0XHR0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuXHRcdHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fTtcblx0XHRcdGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcblx0XHRcdH07XG5cdFx0XHRpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG5cblx0VHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuXHRcdCdvYmplY3RTdG9yZU5hbWVzJyxcblx0XHQnbW9kZSdcblx0XSk7XG5cblx0cHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcblx0XHQnYWJvcnQnXG5cdF0pO1xuXG5cdGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcblx0XHR0aGlzLl9kYiA9IGRiO1xuXHRcdHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG5cdFx0dGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG5cdH1cblxuXHRVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcblx0XHQnbmFtZScsXG5cdFx0J3ZlcnNpb24nLFxuXHRcdCdvYmplY3RTdG9yZU5hbWVzJ1xuXHRdKTtcblxuXHRwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcblx0XHQnZGVsZXRlT2JqZWN0U3RvcmUnLFxuXHRcdCdjbG9zZSdcblx0XSk7XG5cblx0ZnVuY3Rpb24gREIoZGIpIHtcblx0XHR0aGlzLl9kYiA9IGRiO1xuXHR9XG5cblx0REIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG5cdH07XG5cblx0cHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuXHRcdCduYW1lJyxcblx0XHQndmVyc2lvbicsXG5cdFx0J29iamVjdFN0b3JlTmFtZXMnXG5cdF0pO1xuXG5cdHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG5cdFx0J2Nsb3NlJ1xuXHRdKTtcblxuXHQvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuXHQvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG5cdFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuXHRcdFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcblx0XHRcdC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cblx0XHRcdGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuXHRcdFx0Q29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcblx0XHRcdFx0dmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuXHRcdFx0XHR2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG5cdFx0XHRcdHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcblx0XHRcdFx0cmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG5cdFx0XHRcdH07XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyBwb2x5ZmlsbCBnZXRBbGxcblx0W0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuXHRcdGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG5cdFx0Q29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuXHRcdFx0dmFyIGluc3RhbmNlID0gdGhpcztcblx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuXHRcdFx0XHRpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcblx0XHRcdFx0XHRpZiAoIWN1cnNvcikge1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShpdGVtcyk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuXHRcdFx0XHRcdGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShpdGVtcyk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGN1cnNvci5jb250aW51ZSgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH07XG5cdH0pO1xuXG5cdHZhciBleHAgPSB7XG5cdFx0b3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuXHRcdFx0dmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cblx0XHRcdGlmIChyZXF1ZXN0KSB7XG5cdFx0XHRcdHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdFx0XHRpZiAodXBncmFkZUNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHR1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuXHRcdFx0XHRyZXR1cm4gbmV3IERCKGRiKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0ZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRyZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuXHRcdH1cblx0fTtcblxuXHRpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGV4cDtcblx0XHRtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0ZWxzZSB7XG5cdFx0c2VsZi5pZGIgPSBleHA7XG5cdH1cbn0oKSk7XG4iLCJ2YXIgQVBJX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMnO1xudmFyIGZldGNoU3RhdHVzID0gMDtcbnZhciByZXZpZXdzRmV0Y2hTdGF0dXMgPSAwO1xuXG4vLyBIZWxwZXIgRnVuY3Rpb25zIGZvciB2YXJpb3VzIElEYiBPcGVyYXRpb25zXG5jbGFzcyBJRGJPcGVyYXRpb25zSGVscGVyIHtcblx0c3RhdGljIGNoZWNrRm9ySURiU3VwcG9ydCgpIHtcblx0XHRpZiAoISgnaW5kZXhlZERCJyBpbiB3aW5kb3cpKSB7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIDE7XG5cdFx0fVxuXHR9XG5cblx0c3RhdGljIG9wZW5JRGIobmFtZSwgdmVyc2lvbiwgb2JqZWN0U3RvcmVOYW1lKSB7XG5cdFx0dmFyIGRiUHJvbWlzZSA9IGlkYi5vcGVuKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVEQiA9PiB7XG5cdFx0XHR1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lLCB7IGF1dG9JbmNyZW1lbnQ6IHRydWUgfSk7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIGRiUHJvbWlzZTtcblx0fVxuXG5cdHN0YXRpYyBhZGRUb0RiKGRiUHJvbWlzZSwgb2JqZWN0U3RvcmVOYW1lLCBwZXJtaXNpb24sIGpzb25EYXRhKSB7XG5cdFx0ZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuXHRcdFx0dmFyIHRyYW5zYWN0ID0gZGIudHJhbnNhY3Rpb24ob2JqZWN0U3RvcmVOYW1lLCBwZXJtaXNpb24pO1xuXHRcdFx0Ly9BZGQgYWxsIHRoZSBqc29uIGNvbnRlbnQgaGVyZVxuXHRcdFx0dHJhbnNhY3Qub2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lKS5wdXQoanNvbkRhdGEpO1xuXHRcdFx0cmV0dXJuIHRyYW5zYWN0LmNvbXBsZXRlO1xuXHRcdH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coJ1Jlc3RhdXJhbnQgc2F2ZWQgdG8gSURCJyk7XG5cdFx0fSk7XG5cdH1cblxuXHRzdGF0aWMgZ2V0QWxsRGF0YShkYlByb21pc2UsIHRyYW5zYWN0aW9uTmFtZSwgb2JqZWN0U3RvcmVOYW1lKSB7XG5cdFx0dmFyIHJlc3BvbnNlQXJyYXlQcm9taXNlID0gZGJQcm9taXNlLnRoZW4oZGIgPT4gZGJcblx0XHRcdC50cmFuc2FjdGlvbih0cmFuc2FjdGlvbk5hbWUpXG5cdFx0XHQub2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lKVxuXHRcdFx0LmdldEFsbCgpXG5cdFx0KTtcblx0XHRyZXNwb25zZUFycmF5UHJvbWlzZS50aGVuKGFycnkgPT4ge1xuXHRcdFx0SURiT3BlcmF0aW9uc0hlbHBlci5zZXRSZXN0YXVyYW50c0RhdGEoYXJyeSk7XG5cdFx0fSk7XG5cdH1cblxuXHRzdGF0aWMgZ2V0RGF0YUZyb21TZXJ2ZXIoZGJQcm9taXNlLCBvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbiwgY2FsbGJhY2spIHtcblx0XHRmZXRjaChBUElfVVJMKVxuXHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuXHRcdFx0LnRoZW4ocmVzcG9uc2VKc29uID0+IHtcblx0XHRcdFx0cmVzcG9uc2VKc29uLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG5cdFx0XHRcdFx0cmVzdGF1cmFudCA9IElEYk9wZXJhdGlvbnNIZWxwZXIuYWRkTWlzc2luZ0RhdGEocmVzdGF1cmFudCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChmZXRjaFN0YXR1cyAhPSAxKSB7XG5cdFx0XHRcdFx0ZmV0Y2hTdGF0dXMgPSAxO1xuXHRcdFx0XHRcdHJlc3BvbnNlSnNvbi5mb3JFYWNoKHJlc3RhdXJhbnREYXRhID0+IHtcblx0XHRcdFx0XHRcdC8vQWRkIGV2ZXJ5IHNpbmdsZSByZXN0YXVyYW50IGRhdGEgdG8gSURiXG5cdFx0XHRcdFx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmFkZFRvRGIoXG5cdFx0XHRcdFx0XHRcdGRiUHJvbWlzZSxcblx0XHRcdFx0XHRcdFx0b2JqZWN0U3RvcmVOYW1lLFxuXHRcdFx0XHRcdFx0XHRwZXJtaXNpb24sXG5cdFx0XHRcdFx0XHRcdHJlc3RhdXJhbnREYXRhXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlSnNvbik7XG5cdFx0XHRcdGNhbGxiYWNrIChudWxsLCByZXNwb25zZUpzb24pO1xuXHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHQvLyBjb25zb2xlLmxvZyhgVW5hYmxlIHRvIGZldGNoIHJlc3RhdXJhbnRzLCBFcnJvcjogJHtlcnJvcn1gKTtcblx0XHRcdFx0Y2FsbGJhY2sgKGVycm9yLCBudWxsKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0c3RhdGljIGdldFJlc3RhdXJhbnRzRGF0YShjYWxsYmFjaykge1xuXHRcdHZhciBpZGJOYW1lID0gJ3Jlc3RhdXJhbnRzLWRhdGEnO1xuXHRcdHZhciBkYlZlcnNpb24gPSAxO1xuXHRcdHZhciBvYmplY3RTdG9yZU5hbWVTdHJpbmcgPSAncmVzdGF1cmFudHMnO1xuXHRcdHZhciB0cmFuc2FjdGlvbk5hbWVTdHJpbmcgPSAncmVzdGF1cmFudHMnO1xuXHRcdHZhciBkYlBlcm1pc3Npb24gPSAncmVhZHdyaXRlJztcblxuXHRcdHZhciBkYlByb21pc2UgPSBJRGJPcGVyYXRpb25zSGVscGVyLm9wZW5JRGIoXG5cdFx0XHRpZGJOYW1lLFxuXHRcdFx0ZGJWZXJzaW9uLFxuXHRcdFx0b2JqZWN0U3RvcmVOYW1lU3RyaW5nXG5cdFx0KTtcblxuXHRcdGRiUHJvbWlzZS50aGVuKGRiID0+XG5cdFx0XHRkYi50cmFuc2FjdGlvbih0cmFuc2FjdGlvbk5hbWVTdHJpbmcpXG5cdFx0XHRcdC5vYmplY3RTdG9yZShvYmplY3RTdG9yZU5hbWVTdHJpbmcpXG5cdFx0XHRcdC5nZXRBbGwoKVxuXHRcdCkudGhlbihyZXNwb25zZU9iZWpjdHMgPT4ge1xuXHRcdFx0aWYgKHJlc3BvbnNlT2JlamN0cy5sZW5ndGggPD0gMCkge1xuXHRcdFx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldERhdGFGcm9tU2VydmVyKFxuXHRcdFx0XHRcdGRiUHJvbWlzZSxcblx0XHRcdFx0XHRvYmplY3RTdG9yZU5hbWVTdHJpbmcsXG5cdFx0XHRcdFx0ZGJQZXJtaXNzaW9uLFxuXHRcdFx0XHRcdGNhbGxiYWNrXG5cdFx0XHRcdCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZU9iZWpjdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyogRkFJTEVEOjo6IEZ1bmN0aW9uIHRvIHVwZGF0ZSB0aGUgUmVzdGF1cmFudCBkYXRhKi9cblx0c3RhdGljIHVwZGF0ZVJlc3RhdXJhbnREYXRhKHJlc3RhdXJhbnQpIHtcblx0XHR2YXIgaWRiTmFtZSA9ICdyZXN0YXVyYW50cy1kYXRhJztcblx0XHR2YXIgZGJWZXJzaW9uID0gMTtcblx0XHR2YXIgb2JqZWN0U3RvcmVOYW1lID0gJ3Jlc3RhdXJhbnRzJztcblx0XHR2YXIgdHJhbnNhY3Rpb25OYW1lID0gJ3Jlc3RhdXJhbnRzJztcblx0XHR2YXIgZGJQZXJtaXNzaW9uID0gJ3JlYWR3cml0ZSc7XG5cblx0XHR2YXIgZGJQcm9taXNlID0gSURiT3BlcmF0aW9uc0hlbHBlci5vcGVuSURiKFxuXHRcdFx0aWRiTmFtZSxcblx0XHRcdGRiVmVyc2lvbixcblx0XHRcdG9iamVjdFN0b3JlTmFtZVxuXHRcdCk7XG5cblx0XHQvKiBQdXQgSlNPTiBkYXRhIHRvIGluZGV4REIqL1xuXHRcdGRiUHJvbWlzZS50aGVuKGRiID0+IHtcblx0XHRcdCByZXR1cm4gZGIudHJhbnNhY3Rpb24ob2JqZWN0U3RvcmVOYW1lLCBkYlBlcm1pc3Npb24pXG5cdFx0XHQub2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lKVxuXHRcdFx0LnB1dChyZXN0YXVyYW50KVxuXHRcdH1cblx0XHQpLnRoZW4ocmVzID0+IHtcblx0XHRcdGNvbnNvbGUubG9nKCd0ZXN0IHN1Y2Nlc3MnKTtcblx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XG5cdFx0fSkuY2F0Y2goZXJyID0+IHtcblx0XHRcdGNvbnNvbGUubG9nKCd0ZXN0IGZhaWxlZCcpO1xuXHRcdFx0Y29uc29sZS5sb2coZXJyKTtcblx0XHR9KTtcblx0fVxuXG5cdC8vIEhhbmRsZSBmb3IgbGFzdCBlbnRyeSBvbiBSZXN0YXVyYW50cyBMaXN0XG5cdHN0YXRpYyBhZGRNaXNzaW5nRGF0YShyZXN0SnNvbikge1xuXHRcdGlmICghaXNOYU4ocmVzdEpzb24ucGhvdG9ncmFwaCkpIHtcblx0XHRcdHJlc3RKc29uLnBob3RvZ3JhcGggPSByZXN0SnNvbi5waG90b2dyYXBoICsgJy5qcGcnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN0SnNvblsncGhvdG9ncmFwaCddID0gcmVzdEpzb24uaWQgKyAnLmpwZyc7XG5cdFx0fVxuXHRcdHJldHVybiByZXN0SnNvbjtcblx0fVxuXG5cdC8qIEZldGNoIEFsbCByZXZpZXdzIGZyb20gc2VydmVyIGFuZCBzYXZlIHRvIEluZGV4REIgT2JqZWN0U3RvcmUqL1xuXHRzdGF0aWMgZ2V0UmV2aWV3c0Zyb21TZXJ2ZXIoZGJQcm9taXNlLCBvYmplY3RTdG9yZU5hbWUsIHBlcm1pc2lvbiwgY2FsbGJhY2spIHtcblx0XHRmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvYClcblx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcblx0XHRcdC50aGVuKHJlc3BvbnNlSnNvbiA9PiB7XG5cdFx0XHRcdGlmIChyZXZpZXdzRmV0Y2hTdGF0dXMgIT0gMSkge1xuXHRcdFx0XHRcdHJldmlld3NGZXRjaFN0YXR1cyA9IDE7XG5cdFx0XHRcdFx0cmVzcG9uc2VKc29uLmZvckVhY2gocmVzdGF1cmFudERhdGEgPT4ge1xuXHRcdFx0XHRcdFx0SURiT3BlcmF0aW9uc0hlbHBlci5hZGRUb0RiKFxuXHRcdFx0XHRcdFx0XHRkYlByb21pc2UsXG5cdFx0XHRcdFx0XHRcdG9iamVjdFN0b3JlTmFtZSxcblx0XHRcdFx0XHRcdFx0cGVybWlzaW9uLFxuXHRcdFx0XHRcdFx0XHRyZXN0YXVyYW50RGF0YVxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjYWxsYmFjayAobnVsbCwgcmVzcG9uc2VKc29uKTtcblx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coYFVuYWJsZSB0byBmZXRjaCByZXN0YXVyYW50cywgRXJyb3I6ICR7ZXJyb3J9YCk7XG5cdFx0XHRcdGNhbGxiYWNrIChlcnJvciwgbnVsbCk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHN0YXRpYyBnZXRSZXZpZXdzRGF0YShjYWxsYmFjaykge1xuXHRcdHZhciBpZGJOYW1lID0gJ3Jlc3RhdXJhbnRzLWRhdGEnO1xuXHRcdHZhciBkYlZlcnNpb24gPSAxO1xuXHRcdHZhciBvYmplY3RTdG9yZU5hbWVTdHJpbmcgPSAncmV2aWV3cyc7XG5cdFx0dmFyIHRyYW5zYWN0aW9uTmFtZVN0cmluZyA9ICdyZXZpZXdzJztcblx0XHR2YXIgZGJQZXJtaXNzaW9uID0gJ3JlYWR3cml0ZSc7XG5cblx0XHR2YXIgZGJQcm9taXNlID0gSURiT3BlcmF0aW9uc0hlbHBlci5vcGVuSURiKFxuXHRcdFx0aWRiTmFtZSxcblx0XHRcdGRiVmVyc2lvbixcblx0XHRcdG9iamVjdFN0b3JlTmFtZVN0cmluZ1xuXHRcdCk7XG5cblx0XHRkYlByb21pc2UudGhlbihkYiA9PlxuXHRcdFx0ZGIudHJhbnNhY3Rpb24odHJhbnNhY3Rpb25OYW1lU3RyaW5nKVxuXHRcdFx0XHQub2JqZWN0U3RvcmUob2JqZWN0U3RvcmVOYW1lU3RyaW5nKVxuXHRcdFx0XHQuZ2V0QWxsKClcblx0XHQpLnRoZW4ocmVzcG9uc2VPYmVqY3RzID0+IHtcblx0XHRcdGlmIChyZXNwb25zZU9iZWpjdHMubGVuZ3RoIDw9IDApIHtcblx0XHRcdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXZpZXdzRnJvbVNlcnZlcihcblx0XHRcdFx0XHRkYlByb21pc2UsXG5cdFx0XHRcdFx0b2JqZWN0U3RvcmVOYW1lU3RyaW5nLFxuXHRcdFx0XHRcdGRiUGVybWlzc2lvbixcblx0XHRcdFx0XHRjYWxsYmFja1xuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzcG9uc2VPYmVqY3RzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG59XG4iLCIvLyBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbmNsYXNzIERCSGVscGVyIHtcblx0c3RhdGljIGdldCBORVdfVVJMKCkge1xuXHRcdHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzJztcblx0fVxuXHQvKipcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcblx0XHQvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdFx0SURiT3BlcmF0aW9uc0hlbHBlci5nZXRSZXN0YXVyYW50c0RhdGEoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XG5cdFx0XHRcdGlmIChyZXN0YXVyYW50KSB7XG5cdFx0XHRcdFx0Ly8gR290IHRoZSByZXN0YXVyYW50XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2Vcblx0XHRcdFx0XHRjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxuXHRcdGN1aXNpbmUsXG5cdFx0bmVpZ2hib3Job29kLFxuXHRcdGNhbGxiYWNrXG5cdCkge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdElEYk9wZXJhdGlvbnNIZWxwZXIuZ2V0UmVzdGF1cmFudHNEYXRhKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuXHRcdFx0XHRpZiAoY3Vpc2luZSAhPSAnYWxsJykge1xuXHRcdFx0XHRcdC8vIGZpbHRlciBieSBjdWlzaW5lXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykge1xuXHRcdFx0XHRcdC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG4gICAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cdHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHRcdGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoXG5cdFx0XHRcdFx0KHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZFxuXHRcdFx0XHQpO1xuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcblx0XHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxuXHRcdFx0XHRcdCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblx0c3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHRJRGJPcGVyYXRpb25zSGVscGVyLmdldFJlc3RhdXJhbnRzRGF0YSgoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuXHRcdFx0XHRjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihcblx0XHRcdFx0XHQodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpXG5cdFx0XHRcdCk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuICAgICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAgICovXG5cdHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcblx0XHRyZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gO1xuXHR9XG5cblx0LyoqXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAgICovXG5cdHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuXHRcdHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH1gO1xuXHR9XG5cblx0LyoqXG4gICAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgICAqL1xuXHRzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgTC5tYXJrZXIoXG5cdFx0XHRbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuXHRcdFx0e1xuXHRcdFx0XHR0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuXHRcdFx0XHRhbHQ6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdFx0dXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXG5cdFx0XHR9XG5cdFx0KTtcblx0XHRtYXJrZXIuYWRkVG8obmV3TWFwKTtcblx0XHRyZXR1cm4gbWFya2VyO1xuXHR9XG59XG4iXSwiZmlsZSI6ImFwcC1taW4uanMifQ==
